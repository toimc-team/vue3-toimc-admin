import{_ as W}from"./BasicTable.8122f045.js";import{e as U,g as m,R as O,E as w,_ as S,l as A,ea as M,j as B,w as t,o as k,a as E,b as o,k as _,h as P,H as L,b9 as K,e7 as q,M as G,Z as H,a0 as J,c as Z,J as X,r as T,t as Y,a7 as x,B as ee,bm as oe,D as te,d9 as ne,da as ae,db as le}from"./index.6b8e7d20.js";import{E as Q}from"./el-pagination.6faa4b1f.js";import{a as se,s as ue,b as re,c as de,A as ie,e as ce,g as me,h as pe,i as fe,j as _e}from"./AddOrEditUser.b3c25dad.js";import{E as he}from"./el-tree.1ec89225.js";import"./el-checkbox.2f84ff2b.js";/* empty css                  */import{_ as ge}from"./BasicForm.a051860a.js";import{E as De}from"./index.12b7b927.js";import{v as Ce}from"./el-loading.e2386137.js";import{E as ve,a as ye}from"./el-table-column.ebdc8354.js";import{E as Fe}from"./el-popconfirm.c76ab947.js";/* empty css                   */import{E as z}from"./index.d1821638.js";import"./el-image-viewer.fdad5c11.js";/* empty css                */import"./el-progress.9ee01ca6.js";import"./TCard.9fbf5138.js";import"./el-card.caf13488.js";import"./TransitionList.a35e13b1.js";import"./BasicTransition.658eb3e6.js";import"./index.b515aba7.js";/* empty css                       *//* empty css                 */import"./el-upload.d752c630.js";import"./depart.4ce17f40.js";import"./index.b365a39d.js";import"./el-col.dddf495b.js";import"./el-cascader-panel.921fa0a3.js";import"./index.073c6967.js";import"./dayjs.min.954d66e7.js";import"./utils.790c0546.js";import"./index.d60f0620.js";import"./TInput.268107bf.js";import"./index.23de40b8.js";import"./index.99bf0e70.js";import"./index.72600d57.js";import"./index.8ee93c4a.js";let j=[];const Ee=U({props:{showDrawer:{type:Boolean,default:!1},defaultKeys:{type:Array,default:()=>[]},roleId:{type:String,default:""}},emits:["onConfirm","close"],setup(e,n){let p=m([]);const l={children:"children",label:"name",value:"id"},h=m(!1);function v(){e.showDrawer&&n.emit("close")}function i(){n.emit("close")}const u=m([]),r=(c,F)=>{u.value=F.checkedKeys};(()=>{se().then(c=>{p.value=c==null?void 0:c.data})})();const g=()=>{e.roleId,re(e.roleId).then(c=>{a(c.data)})},a=c=>{j=[...c],u.value=c},f=c=>{let F={roleId:e.roleId,lastPermissionIds:j.join(","),permissionIds:u.value.join(",")};h.value=!0,ue(F).then(y=>{h.value=!1,y.code===0||w({message:`${y.message}`,type:"error"}),c&&v()})};return O(()=>e.roleId,()=>{e.showDrawer&&g()}),{defaultProps:l,checkedKeys:u,treeData:p,btnLoading:h,cancelClick:i,onClose:v,onCheck:r,saveInfo:f}}}),be=E("h4",{class:"divide-y divide-gray-500/50"},"\u89D2\u8272\u6743\u9650\u914D\u7F6E",-1),we={style:{"min-height":"360px"}},ke={style:{flex:"auto"}},$e=_("\u53D6\u6D88"),Ie=_("\u4EC5\u4FDD\u5B58"),Be=_("\u4FDD\u5B58\u5E76\u5173\u95ED");function Re(e,n,p,l,h,v){const i=he,u=A,r=M;return k(),B(r,{"model-value":e.showDrawer,direction:"rtl",onClose:e.onClose},{title:t(()=>[be]),footer:t(()=>[E("div",ke,[o(u,{onClick:e.cancelClick},{default:t(()=>[$e]),_:1},8,["onClick"]),o(u,{type:"primary",loading:e.btnLoading,onClick:n[0]||(n[0]=d=>e.saveInfo(!1))},{default:t(()=>[Ie]),_:1},8,["loading"]),o(u,{type:"primary",loading:e.btnLoading,onClick:n[1]||(n[1]=d=>e.saveInfo(!0))},{default:t(()=>[Be]),_:1},8,["loading"])])]),default:t(()=>[E("div",we,[o(i,{data:e.treeData,props:e.defaultProps,"node-key":"id","default-checked-keys":e.checkedKeys,"show-checkbox":"","default-expand-all":"",onCheck:e.onCheck},null,8,["data","props","default-checked-keys","onCheck"])])]),_:1},8,["model-value","onClose"])}const Ne=S(Ee,[["render",Re]]),Te=U({props:{showDialog:{type:Boolean,default:!1},role:{type:Object,default:()=>null},isEdit:{type:Boolean,default:!1}},emits:["success","close"],setup(e,{emit:n}){const p=m(!1),l=P({id:"",roleCode:"",roleName:"",createTime:"",description:"",createBy:"",updateBy:"",updateTime:""}),h=m(!1);let v=m([]);const i=()=>{h.value=!1;let a=[{component:"input",value:l.roleCode,label:"\u89D2\u8272\u7F16\u7801",prop:"roleCode",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u7F16\u7801",trigger:"blur"}],attrs:{placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u7F16\u7801",disabled:!!e.isEdit}},{component:"input",value:l.roleName,label:"\u89D2\u8272\u540D\u79F0",prop:"roleName",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0",trigger:"blur"}],attrs:{placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0"}},{component:"input",label:"\u63CF\u8FF0",prop:"description",value:l.description,attrs:{type:"textarea",placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u63CF\u8FF0"}}];v.value=[...a],setTimeout(()=>{h.value=!0},50)};i();const u=()=>{n("close")},r=()=>{},d=(a,f)=>{!a||a.validate(c=>{if(c)l.roleName=f.roleName,l.description=f.description,l.roleCode=f.roleCode,g();else return!1})},g=()=>{p.value=!0;const a={roleCode:l.roleCode,roleName:l.roleName,description:l.description};e.isEdit&&(a.id=l.id||"",a.createTime=l.createTime||"",a.createBy=l.createBy||""),de(a,e.isEdit).then(f=>{p.value=!1,f.code==200?(w({message:`${f.message}`,type:"success"}),n("success")):(u(),w({message:`${f.message}`,type:"error"}))}).catch(()=>{p.value=!1,u(),w({message:"\u64CD\u4F5C\u5931\u8D25",type:"error"})})};return O(()=>e.role,a=>{e.showDialog&&(l.roleCode=a.roleCode||"",l.roleName=a.roleName||"",l.description=a.description||"",l.id=a.id||"",l.createTime=a.createTime||"",l.createBy=a.createBy||"",l.updateBy=a.updateBy||"",l.updateTime=a.updateTime||"",i())},{immediate:!0}),{formBasicSchema:v,loading:p,isLoadedForm:h,submitForm:d,opened:r,close:u}}}),Ue={class:"dialog-footer flex justify-end"},Se=_("\u53D6\u6D88"),Ae=_("\u786E\u8BA4");function Ve(e,n,p,l,h,v){const i=A,u=ge,r=De;return k(),B(r,{"model-value":e.showDialog,title:e.isEdit?"\u7F16\u8F91":"\u65B0\u589E",center:"",onClose:e.close,onOpened:e.opened},{default:t(()=>[e.isLoadedForm?(k(),B(u,{key:0,schemas:e.formBasicSchema},{action:t(({form:d,model:g})=>[E("span",Ue,[o(i,{onClick:e.close},{default:t(()=>[Se]),_:1},8,["onClick"]),o(i,{type:"primary",loading:e.loading,onClick:a=>e.submitForm(d,g)},{default:t(()=>[Ae]),_:2},1032,["loading","onClick"])])]),_:1},8,["schemas"])):L("",!0)]),_:1},8,["model-value","title","onClose","onOpened"])}const Pe=S(Te,[["render",Ve]]),ze=U({components:{AddOrEditUser:ie},props:{show:{type:Boolean,default:!1},roleId:{type:String,default:""}},emits:["close"],setup(e,n){const p=P({username:"",realname:"",departName:""}),l=m({}),h=m(!1),v=m(!1),i=m([]),u=m([]),r=m(0),d=P({pageNo:1,pageSize:10,roleId:e.roleId,realname:"",departName:"",username:""}),g=()=>{z.confirm("\u662F\u5426\u53D6\u6D88\u5173\u8054\u9009\u4E2D\u6570\u636E?","\u786E\u8BA4\u53D6\u6D88\u5173\u8054",{confirmButtonText:"\u786E\u8BA4",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{let s=i.value.map(C=>C.id);const b={roleId:e.roleId,userIds:s.join(",")};f(b)})},a=s=>{const b={roleId:e.roleId,userIds:s.id};f(b)},f=s=>{ce(s).then(b=>{b.code===0?(w({type:"success",message:"\u53D6\u6D88\u6210\u529F"}),c()):w({type:"error",message:b.message})})},c=()=>{d.pageNo=1,d.pageSize=10,F()},F=()=>{d.roleId=e.roleId,d.username=p.username,d.departName="*"+p.departName+"*",d.realname="*"+p.realname+"*",h.value=!0,me(d).then(s=>{u.value=s.data.records,h.value=!1,r.value=s.data.total})},y=s=>{d.pageNo=s,F()},$=()=>{p.username=""},D=s=>{i.value=s},I=s=>{s?l.value=s:l.value={},v.value=!0},R=()=>{n.emit("close")};return O(()=>e.roleId,()=>{c()},{immediate:!0}),{Search:K,Refresh:q,userInfo:l,loading:h,formInline:p,tableData:u,tableTotal:r,formData:d,multipleSelection:i,showAddEditRoleUser:v,onAddOrEditUser:I,handleSelectionChange:D,handleCurrentChange:y,confirmDelEvent:a,onSubmit:c,onDelUser:g,onRestForm:$,onClose:R}}});const Oe={class:"divide-y divide-gray-500/50"},Le={class:"overflow-auto",style:{width:"100%","max-height":"700px"}},je=_("\u67E5\u8BE2"),Me=_("\u91CD\u7F6E"),Ke=_("\u65B0\u589E\u7528\u6237"),qe=_("\u53D6\u6D88\u5173\u8054"),Ge=_("\u7F16\u8F91"),He=_("\u53D6\u6D88\u5173\u8054"),Je={class:"mt-4 flex justify-end"};function Ze(e,n,p,l,h,v){const i=G,u=H,r=A,d=J,g=ve,a=Fe,f=ye,c=Q,F=M,y=T("add-or-edit-user"),$=Ce;return k(),Z(X,null,[o(F,{"model-value":e.show,direction:"rtl",size:"930px",onClose:e.onClose},{title:t(()=>[E("h4",Oe,"\u89D2\u8272\u7528\u6237\u3010"+Y(e.roleId)+"\u3011",1)]),default:t(()=>[E("div",Le,[o(d,{inline:!0,model:e.formInline,class:"demo-form-inline"},{default:t(()=>[o(u,{label:"\u7528\u6237\u8D26\u53F7"},{default:t(()=>[o(i,{modelValue:e.formInline.username,"onUpdate:modelValue":n[0]||(n[0]=D=>e.formInline.username=D),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u8D26\u53F7"},null,8,["modelValue"])]),_:1}),o(u,{label:"\u7528\u6237\u59D3\u540D"},{default:t(()=>[o(i,{modelValue:e.formInline.realname,"onUpdate:modelValue":n[1]||(n[1]=D=>e.formInline.realname=D),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u8D26\u53F7"},null,8,["modelValue"])]),_:1}),o(u,{label:"\u6240\u5C5E\u90E8\u95E8"},{default:t(()=>[o(i,{modelValue:e.formInline.departName,"onUpdate:modelValue":n[2]||(n[2]=D=>e.formInline.departName=D),placeholder:"\u8BF7\u8F93\u5165\u6240\u5C5E\u90E8\u95E8"},null,8,["modelValue"])]),_:1}),o(u,null,{default:t(()=>[o(r,{type:"primary",icon:e.Search,onClick:e.onSubmit},{default:t(()=>[je]),_:1},8,["icon","onClick"]),o(r,{icon:e.Refresh,onClick:e.onRestForm},{default:t(()=>[Me]),_:1},8,["icon","onClick"]),o(r,{type:"primary",onClick:n[3]||(n[3]=D=>e.onAddOrEditUser(null))},{default:t(()=>[Ke]),_:1}),e.multipleSelection.length>0?(k(),B(r,{key:0,onClick:e.onDelUser},{default:t(()=>[qe]),_:1},8,["onClick"])):L("",!0)]),_:1})]),_:1},8,["model"]),x((k(),B(f,{ref:"multipleTableRef",data:e.tableData,style:{width:"100%"},border:"",align:"center",onSelectionChange:e.handleSelectionChange},{default:t(()=>[o(g,{type:"selection",width:"55"}),o(g,{property:"username",label:"\u7528\u6237\u8D26\u53F7",align:"center"}),o(g,{property:"realname",label:"\u7528\u6237\u59D3\u540D",align:"center"}),o(g,{property:"departIds_dictText",label:"\u90E8\u95E8",align:"center"}),o(g,{property:"status_dictText",label:"\u72B6\u6001",width:"80",align:"center"}),o(g,{label:"\u64CD\u4F5C",width:"120",align:"center"},{default:t(D=>[o(r,{type:"text",size:"small",onClick:I=>e.onAddOrEditUser(D.row)},{default:t(()=>[Ge]),_:2},1032,["onClick"]),o(a,{title:"\u662F\u5426\u786E\u8BA4\u53D6\u6D88\u5173\u8054?","confirm-button-text":"\u786E\u8BA4","cancel-button-text":"\u53D6\u6D88",onConfirm:I=>e.confirmDelEvent(D.row)},{reference:t(()=>[o(r,{type:"text",size:"small"},{default:t(()=>[He]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data","onSelectionChange"])),[[$,e.loading]]),E("div",Je,[o(c,{currentPage:e.formData.pageNo,"onUpdate:currentPage":n[4]||(n[4]=D=>e.formData.pageNo=D),background:"","page-size":e.formData.pageSize,layout:"prev, pager, next",total:e.tableTotal,onCurrentChange:e.handleCurrentChange},null,8,["currentPage","page-size","total","onCurrentChange"])])])]),_:1},8,["model-value","onClose"]),o(y,{ref:"addOrEditUserRef",show:e.showAddEditRoleUser,user:e.userInfo,"role-id":e.roleId,onClose:n[5]||(n[5]=D=>e.showAddEditRoleUser=!1)},null,8,["show","user","role-id"])],64)}const Qe=S(ze,[["render",Ze],["__scopeId","data-v-5e8fd2ce"]]),We=U({components:{HasRole:Ne,AddRole:Pe,RoleUser:Qe},setup(){const e=m(),n=m(0),p=m([]),l=m(""),h=m(!0),v=m(!1),i=m(!1),u=m(!1),r=m(!1),d=m({id:""}),g=[{type:"selection",align:"center"},{label:"\u89D2\u8272\u7F16\u7801",prop:"roleCode",align:"center"},{label:"\u89D2\u8272\u540D\u79F0",prop:"roleName",align:"center"},{label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime",align:"center",attrs:{sortable:!0}},{label:"\u64CD\u4F5C",slot:"action",align:"center"}],a=m({pageNo:1,pageSize:10,roleName:"",column:"createTime",order:"desc"}),f=C=>{a.value.pageNo=C,y()},c=()=>{a.value.pageNo=1,y()},F=()=>{a.value.pageNo=1,a.value.roleName=""},y=()=>{h.value=!0,pe(a.value).then(C=>{h.value=!1,C.code===0?(p.value=C.data.records,n.value=C.data.total):w.error(C.message)})};y();const $=()=>{d.value={id:""},r.value=!1,i.value=!0},D=()=>{y()},I=C=>{l.value=C.id,u.value=!0},R=C=>{switch(C.index){case 0:C.row,v.value=!0;break;case 1:d.value=C.row,r.value=!0,i.value=!0,C.row;break;case 2:C.row,z.confirm("\u786E\u5B9A\u5220\u9664\u5417\uFF1F","\u6E29\u99A8\u63D0\u793A").then(()=>{fe({id:C.row.id}).then(V=>{w({message:`${V.message}`,type:"error"})})}).catch(()=>{});break}},s=()=>{z.confirm("\u662F\u5426\u5220\u9664\u9009\u4E2D\u6570\u636E?","\u786E\u8BA4\u5220\u9664",{confirmButtonText:"\u786E\u8BA4",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{const V={roleIds:b.value.map(N=>N.id).join(",")};_e(V).then(N=>{N.code===0?(w({message:`${N.message}`,type:"success"}),y()):w({message:`${N.message}`,type:"error"})})})},b=ee(()=>e.value?e.value.getSelectionRows()||[]:[]);return{Search:K,Refresh:q,Delete:oe,checkedKeys:b,loading:h,tableRef:e,formData:a,tableTotal:n,columns:g,tableData:p,roleId:l,showDrawer:v,showRoleUser:u,showDialog:i,isEdit:r,editRoleInfo:d,handleCurrentChange:f,addRole:$,onDelRole:s,addOrUpdateRoleSuccess:D,getTableList:y,findUser:I,handleMoreCommand:R,onGetTableData:c,onRestForm:F}}});const Xe={class:"p-4"},Ye={class:"mb-2"},xe=_("\u67E5\u8BE2"),eo=_("\u91CD\u7F6E"),oo=_("\u6279\u91CF\u5220\u9664"),to={class:"flex mb-2"},no=_(" \u65B0\u589E\u89D2\u8272"),ao=_("\u7528\u6237"),lo={class:"el-dropdown-link ml-2"},so=_("\u66F4\u591A"),uo=_("\u6388\u6743"),ro=_("\u7F16\u8F91"),io=_("\u5220\u9664"),co={class:"mt-4 flex justify-end"};function mo(e,n,p,l,h,v){const i=G,u=H,r=A,d=J,g=T("arrow-down"),a=te,f=ne,c=ae,F=le,y=Q,$=W,D=T("has-role"),I=T("add-role"),R=T("role-user");return k(),Z("div",Xe,[o($,{ref:"tableRef",border:!0,data:e.tableData,columns:e.columns,loading:e.loading,"default-sort":{prop:"date"}},{header:t(()=>[E("div",Ye,[o(d,{inline:!0,model:e.formData,class:"demo-form-inline"},{default:t(()=>[o(u,{label:"\u89D2\u8272\u540D\u79F0"},{default:t(()=>[o(i,{modelValue:e.formData.roleName,"onUpdate:modelValue":n[0]||(n[0]=s=>e.formData.roleName=s),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0"},null,8,["modelValue"])]),_:1}),o(u,null,{default:t(()=>[o(r,{type:"primary",icon:e.Search,onClick:e.onGetTableData},{default:t(()=>[xe]),_:1},8,["icon","onClick"]),o(r,{icon:e.Refresh,onClick:e.onRestForm},{default:t(()=>[eo]),_:1},8,["icon","onClick"]),e.checkedKeys.length>0?(k(),B(r,{key:0,icon:e.Delete,type:"danger",onClick:e.onDelRole},{default:t(()=>[oo]),_:1},8,["icon","onClick"])):L("",!0)]),_:1})]),_:1},8,["model"])]),E("div",to,[o(r,{type:"primary",icon:"Plus",onClick:e.addRole},{default:t(()=>[no]),_:1},8,["onClick"])])]),action:t(({row:s})=>[o(r,{type:"text",onClick:b=>e.findUser(s)},{default:t(()=>[ao]),_:2},1032,["onClick"]),o(F,{onCommand:e.handleMoreCommand},{dropdown:t(()=>[o(c,null,{default:t(()=>[o(f,{command:{index:0,row:s}},{default:t(()=>[uo]),_:2},1032,["command"]),o(f,{command:{index:1,row:s}},{default:t(()=>[ro]),_:2},1032,["command"]),o(f,{command:{index:2,row:s}},{default:t(()=>[io]),_:2},1032,["command"])]),_:2},1024)]),default:t(()=>[E("span",lo,[o(r,{type:"text"},{default:t(()=>[so,o(a,{class:"el-icon--right"},{default:t(()=>[o(g)]),_:1})]),_:1})])]),_:2},1032,["onCommand"])]),"footer-with-pagination":t(()=>[E("div",co,[o(y,{currentPage:e.formData.pageNo,"onUpdate:currentPage":n[1]||(n[1]=s=>e.formData.pageNo=s),background:"","page-size":e.formData.pageSize,layout:"prev, pager, next",total:e.tableTotal,onCurrentChange:e.handleCurrentChange},null,8,["currentPage","page-size","total","onCurrentChange"])])]),_:1},8,["data","columns","loading"]),o(D,{"show-drawer":e.showDrawer,"role-id":e.roleId,onClose:n[2]||(n[2]=s=>e.showDrawer=!1)},null,8,["show-drawer","role-id"]),o(I,{"show-dialog":e.showDialog,"is-edit":e.isEdit,role:e.editRoleInfo,onClose:n[3]||(n[3]=s=>e.showDialog=!1),onSuccess:e.addOrUpdateRoleSuccess},null,8,["show-dialog","is-edit","role","onSuccess"]),o(R,{show:e.showRoleUser,"role-id":e.roleId,onClose:n[4]||(n[4]=s=>e.showRoleUser=!1)},null,8,["show","role-id"])])}const Xo=S(We,[["render",mo],["__scopeId","data-v-b703cff5"]]);export{Xo as default};
