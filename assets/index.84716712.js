import{e as A,g as c,h as W,E as k,_ as N,M as U,Z as G,a0 as H,l as L,j as V,w as t,o as y,a as v,b as o,H as T,c as $,J as B,k as b,R as x,d9 as ee,da as oe,db as ae,r as F,t as O,a7 as P,m as te,q as le,$ as ne,a8 as K}from"./index.6b8e7d20.js";import{_ as de}from"./TCard.9fbf5138.js";import{E as re}from"./el-col.dddf495b.js";import{v as se}from"./el-loading.e2386137.js";import{E as ue}from"./el-card.caf13488.js";import{E as J}from"./el-tree.1ec89225.js";import"./el-checkbox.2f84ff2b.js";import{E as me}from"./el-alert.049ff685.js";import{s as Z,d as M,a as ie,b as pe,q as fe}from"./depart.4ce17f40.js";/* empty css                  *//* empty css                        *//* empty css                       *//* empty css                        */import{E as z,g as ce}from"./menu.6acb5520.js";import{a as Q,b as X}from"./index.b365a39d.js";import{E as Y}from"./index.23de40b8.js";import{E as _e}from"./index.12b7b927.js";import{E as he}from"./index.d1821638.js";import"./TransitionList.a35e13b1.js";import"./BasicTransition.658eb3e6.js";import"./index.d60f0620.js";import"./index.8ee93c4a.js";const be=A({props:{dialogFormVisible:{type:Boolean,default:!1},parentId:{type:String,default:""},treeData:{type:Array,default:()=>[]}},emits:["cancel","success"],setup(e,{emit:a}){const h=c(),d=W({departName:[{required:!0,message:"\u8BF7\u8F93\u5165\u90E8\u95E8\u540D\u79F0",trigger:"blur"}]}),u=W({departName:"",parentId:"",orgCategory:"1",departOrder:0,mobile:"",address:"",memo:""}),D={children:"children",label:"departName",value:"id"},r="120px",l=c(!1),n=async m=>{!m||await m.validate((g,i)=>{g&&p()})},s=()=>{a("cancel")},C=()=>{u.departName="",u.parentId=e.parentId,u.orgCategory=e.parentId?"2":"1",u.departOrder=0,u.mobile="",u.address="",u.memo=""},p=()=>{l.value=!0,Z(u,!1).then(m=>{l.value=!1,m.code==200?(k({message:`${m.message}`,type:"success"}),a("success")):(s(),k({message:`${m.message}`,type:"error"}))}).catch(()=>{l.value=!1,s(),k({message:"\u64CD\u4F5C\u5931\u8D25",type:"error"})})};return{ruleFormRef:h,rules:d,defaultProps:D,formData:u,formLabelWidth:r,loading:l,opened:C,close:s,submitForm:n}}});const De=b("\u516C\u53F8"),ye=b("\u90E8\u95E8"),ge=b("\u5C97\u4F4D"),Ce={class:"dialog-footer flex justify-end"},ve=b("\u53D6\u6D88"),ke=b("\u786E\u8BA4");function Ee(e,a,h,d,u,D){const r=U,l=G,n=z,s=Q,C=X,p=Y,m=H,g=L,i=_e;return y(),V(i,{"model-value":e.dialogFormVisible,title:"\u65B0\u589E",width:"520px",center:"",onClose:e.close,onOpened:e.opened},{footer:t(()=>[v("span",Ce,[o(g,{onClick:e.close},{default:t(()=>[ve]),_:1},8,["onClick"]),o(g,{type:"primary",loading:e.loading,onClick:a[7]||(a[7]=f=>e.submitForm(e.ruleFormRef))},{default:t(()=>[ke]),_:1},8,["loading"])])]),default:t(()=>[o(m,{ref:"ruleFormRef",model:e.formData,rules:e.rules},{default:t(()=>[o(l,{label:"\u673A\u6784\u540D\u79F0","label-width":e.formLabelWidth,prop:"departName"},{default:t(()=>[o(r,{modelValue:e.formData.departName,"onUpdate:modelValue":a[0]||(a[0]=f=>e.formData.departName=f),autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"]),e.parentId!=""?(y(),V(l,{key:0,label:"\u4E0A\u7EA7\u90E8\u95E8","label-width":e.formLabelWidth},{default:t(()=>[o(n,{modelValue:e.formData.parentId,"onUpdate:modelValue":a[1]||(a[1]=f=>e.formData.parentId=f),clearable:"","node-key":"id",data:e.treeData,"default-expand-all":"",props:e.defaultProps,placeholder:" "},null,8,["modelValue","data","props"])]),_:1},8,["label-width"])):T("",!0),o(l,{label:"\u673A\u6784\u7C7B\u578B","label-width":e.formLabelWidth},{default:t(()=>[o(C,{modelValue:e.formData.orgCategory,"onUpdate:modelValue":a[2]||(a[2]=f=>e.formData.orgCategory=f)},{default:t(()=>[e.formData.orgCategory==1?(y(),V(s,{key:0,label:"1"},{default:t(()=>[De]),_:1})):(y(),$(B,{key:1},[o(s,{label:"2"},{default:t(()=>[ye]),_:1}),o(s,{label:"3"},{default:t(()=>[ge]),_:1})],64))]),_:1},8,["modelValue"])]),_:1},8,["label-width"]),o(l,{label:"\u6392\u5E8F","label-width":e.formLabelWidth},{default:t(()=>[o(p,{modelValue:e.formData.departOrder,"onUpdate:modelValue":a[3]||(a[3]=f=>e.formData.departOrder=f),min:0,max:9999999999,"controls-position":"right"},null,8,["modelValue"])]),_:1},8,["label-width"]),o(l,{label:"\u7535\u8BDD","label-width":e.formLabelWidth},{default:t(()=>[o(r,{modelValue:e.formData.mobile,"onUpdate:modelValue":a[4]||(a[4]=f=>e.formData.mobile=f),autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"]),o(l,{label:"\u5730\u5740","label-width":e.formLabelWidth},{default:t(()=>[o(r,{modelValue:e.formData.address,"onUpdate:modelValue":a[5]||(a[5]=f=>e.formData.address=f),autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"]),o(l,{label:"\u5907\u6CE8","label-width":e.formLabelWidth},{default:t(()=>[o(r,{modelValue:e.formData.memo,"onUpdate:modelValue":a[6]||(a[6]=f=>e.formData.memo=f),autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"])]),_:1},8,["model","rules"])]),_:1},8,["model-value","onClose","onOpened"])}const Ve=N(be,[["render",Ee],["__scopeId","data-v-77181952"]]),$e=A({components:{DepartFormModal:Ve},props:{treeData:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["on-node-click"],setup(e,{emit:a}){const h={children:"children",label:"departName",value:"id"},d=c(!1),u=c(!1),D=c([]),r=c(),l=c("");x(l,_=>{r.value.filter(_)});const n=()=>{d.value=!1},s=()=>{d.value=!1},C=(_,E,S)=>{w.value=_.id,a("on-node-click",_)},p=(_,{node:E})=>{},m=(_,E)=>{D.value=E.checkedKeys},g=_=>{he.confirm("\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F","\u6E29\u99A8\u63D0\u793A",{confirmButtonText:"\u786E\u8BA4",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{let E={lds:_.id};M(E).then(S=>{k({type:"success",message:S.message})})}).catch(()=>{k({type:"info",message:"Delete canceled"})})},i=()=>{M({ids:D.value.join(",")}).then(_=>{k({type:"success",message:_.message})})},f=()=>{w.value="",d.value=!0},w=c("");return{modelParentId:w,dialogFormVisible:d,checkedKeys:D,filterText:l,treeReloading:u,defaultProps:h,onDelDepart:g,onAddDepart:f,onDeleteBatch:i,onAddChildDepart:_=>{w.value=_||"",d.value=!0},onSuccess:n,onCancel:s,filterNode:(_,E)=>_?(E.departName,E.departName.includes(_)):!0,onCheckChange:p,check:m,nodeClick:C}}}),we={class:"flex",style:{"margin-bottom":"8px"}},Ie=b("\u65B0\u589E"),Fe=b("\u6DFB\u52A0\u4E0B\u7EA7"),Be=b("\u6279\u91CF\u64CD\u4F5C"),Ae=b("\u5220\u9664"),Ne={key:1},Le=b("\u6DFB\u52A0\u5B50\u7EA7"),Re=v("span",{style:{color:"red"}},"\u5220\u9664",-1);function Te(e,a,h,d,u,D){const r=L,l=ee,n=oe,s=ae,C=F("a-divider"),p=me,m=U,g=J,i=F("depart-form-modal"),f=ue,w=se;return y(),V(f,{class:"box-card border-none",style:{height:"100%"}},{default:t(()=>[v("div",we,[o(r,{type:"primary",onClick:e.onAddDepart},{default:t(()=>[Ie]),_:1},8,["onClick"]),o(r,{type:"primary",style:{"margin-right":"8px"},disabled:!e.modelParentId,onClick:a[0]||(a[0]=I=>e.onAddChildDepart(e.modelParentId))},{default:t(()=>[Fe]),_:1},8,["disabled"]),e.checkedKeys.length>0?(y(),V(s,{key:0},{dropdown:t(()=>[o(n,null,{default:t(()=>[o(l,{key:"1",onClick:e.onDeleteBatch},{default:t(()=>[Ae]),_:1},8,["onClick"])]),_:1})]),default:t(()=>[o(r,null,{default:t(()=>[Be]),_:1})]),_:1})):T("",!0)]),o(p,{"show-icon":"",type:"info",closable:!1,style:{"margin-bottom":"8px"}},{default:t(()=>[e.checkedKeys.length>0?(y(),$(B,{key:0},[v("span",null,"\u5DF2\u9009\u4E2D "+O(e.checkedKeys.length)+" \u6761\u8BB0\u5F55",1),o(C,{type:"vertical"}),v("a",{onClick:a[1]||(a[1]=I=>e.checkedKeys=[])},"\u6E05\u7A7A")],64)):(y(),$("span",Ne,"\u672A\u9009\u4E2D\u4EFB\u4F55\u6570\u636E"))]),_:1}),P((y(),$("div",null,[o(m,{modelValue:e.filterText,"onUpdate:modelValue":a[2]||(a[2]=I=>e.filterText=I),placeholder:"\u6309\u90E8\u95E8\u540D\u79F0\u641C\u7D22\u2026",style:{"margin-bottom":"10px"}},null,8,["modelValue"]),e.treeReloading?T("",!0):(y(),V(g,{key:0,ref:"treeRef",class:"filter-tree",data:e.treeData,props:e.defaultProps,"show-checkbox":"","node-key":"id","default-expand-all":"","expand-on-click-node":!1,"filter-node-method":e.filterNode,onCheckChange:e.onCheckChange,onCheck:e.check,onNodeClick:e.nodeClick},{default:t(({node:I,data:R})=>[o(s,{ref:"dropDownRef",trigger:"contextmenu",placement:"bottom-end"},{dropdown:t(()=>[o(n,null,{default:t(()=>[o(l,{onClick:_=>e.onAddChildDepart(R.id)},{default:t(()=>[Le]),_:2},1032,["onClick"]),o(l,{onClick:_=>e.onDelDepart(R)},{default:t(()=>[Re]),_:2},1032,["onClick"])]),_:2},1024)]),default:t(()=>[v("div",null,O(I.label),1)]),_:2},1536)]),_:1},8,["data","props","filter-node-method","onCheckChange","onCheck","onNodeClick"]))])),[[w,e.loading]]),o(i,{"parent-id":e.modelParentId,"tree-data":e.treeData,"dialog-form-visible":e.dialogFormVisible,onSuccess:e.onSuccess,onCancel:e.onCancel},null,8,["parent-id","tree-data","dialog-form-visible","onSuccess","onCancel"])]),_:1})}const Pe=N($e,[["render",Te]]);let q={};const Ue=A({props:{treeData:{type:Array,default:()=>[]}},emits:["on-save"],setup(e,{emit:a}){const h="120px";let d=c({departName:"",parentId:"",orgCategory:"1",departOrder:0,mobile:"",address:"",memo:""});return{props:e,defaultProps:{children:"children",label:"departName",value:"id"},formLabelWidth:h,formData:d,setFormInfo:n=>{q={...n},d.value=n},saveInfo:()=>{a("on-save",d.value)},resetInfo:()=>{d.value={...q}}}}}),Se=b("\u516C\u53F8"),We=b("\u90E8\u95E8"),Oe=b("\u5C97\u4F4D"),Ke={class:"form-footer flex justify-end pr-2"},Me=b("\u91CD\u7F6E"),qe=b("\u4FDD\u5B58");function je(e,a,h,d,u,D){const r=U,l=G,n=z,s=Q,C=X,p=Y,m=H,g=L;return y(),$(B,null,[o(m,{model:e.formData},{default:t(()=>[o(l,{label:"\u673A\u6784\u540D\u79F0","label-width":e.formLabelWidth},{default:t(()=>[o(r,{modelValue:e.formData.departName,"onUpdate:modelValue":a[0]||(a[0]=i=>e.formData.departName=i),autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"]),o(l,{label:"\u4E0A\u7EA7\u90E8\u95E8","label-width":e.formLabelWidth},{default:t(()=>[o(n,{modelValue:e.formData.parentId,"onUpdate:modelValue":a[1]||(a[1]=i=>e.formData.parentId=i),disabled:"","node-key":"id",data:e.treeData,props:e.defaultProps,placeholder:" ","check-strictly":""},null,8,["modelValue","data","props"])]),_:1},8,["label-width"]),o(l,{label:"\u673A\u6784\u7C7B\u578B","label-width":e.formLabelWidth},{default:t(()=>[o(C,{modelValue:e.formData.orgCategory,"onUpdate:modelValue":a[2]||(a[2]=i=>e.formData.orgCategory=i)},{default:t(()=>[e.formData.orgCategory==1?(y(),V(s,{key:0,label:"1"},{default:t(()=>[Se]),_:1})):(y(),$(B,{key:1},[o(s,{label:"2"},{default:t(()=>[We]),_:1}),o(s,{label:"3"},{default:t(()=>[Oe]),_:1})],64))]),_:1},8,["modelValue"])]),_:1},8,["label-width"]),o(l,{label:"\u6392\u5E8F","label-width":e.formLabelWidth},{default:t(()=>[o(p,{modelValue:e.formData.departOrder,"onUpdate:modelValue":a[3]||(a[3]=i=>e.formData.departOrder=i),min:0,max:9999999999,"controls-position":"right"},null,8,["modelValue"])]),_:1},8,["label-width"]),o(l,{label:"\u7535\u8BDD","label-width":e.formLabelWidth},{default:t(()=>[o(r,{modelValue:e.formData.mobile,"onUpdate:modelValue":a[4]||(a[4]=i=>e.formData.mobile=i),autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"]),o(l,{label:"\u5730\u5740","label-width":e.formLabelWidth},{default:t(()=>[o(r,{modelValue:e.formData.address,"onUpdate:modelValue":a[5]||(a[5]=i=>e.formData.address=i),autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"]),o(l,{label:"\u5907\u6CE8","label-width":e.formLabelWidth},{default:t(()=>[o(r,{modelValue:e.formData.memo,"onUpdate:modelValue":a[6]||(a[6]=i=>e.formData.memo=i),type:"textarea"},null,8,["modelValue"])]),_:1},8,["label-width"])]),_:1},8,["model"]),v("div",Ke,[o(g,{onClick:e.resetInfo},{default:t(()=>[Me]),_:1},8,["onClick"]),o(g,{type:"primary",onClick:e.saveInfo},{default:t(()=>[qe]),_:1},8,["onClick"])])],64)}const Ge=N(Ue,[["render",je]]);let j=[];const He=A({props:{defaultKeys:{type:Array,default:()=>[]},departId:{type:String,default:""}},setup(e){let a=c([]);const h={children:"children",label:"name",value:"id"},d=c([]),u=(n,s)=>{d.value=s.checkedKeys};return(()=>{ce().then(n=>{a.value=n==null?void 0:n.data})})(),{props:e,defaultProps:h,checkedKeys:d,treeData:a,onCheck:u,setCheckedKeys:n=>{j=[...n],d.value=n},saveInfo:()=>{let n={departId:e.departId,lastPermissionIds:j,permissionIds:d.value};ie(n).then(s=>{s.code===200||k({message:`${s.message}`,type:"error"})})}}}}),Je={style:{"min-height":"360px"}},Ze={class:"form-footer flex justify-end mr-2"},ze=b("\u4FDD\u5B58");function Qe(e,a,h,d,u,D){const r=J,l=L;return y(),$(B,null,[v("div",Je,[o(r,{data:e.treeData,props:e.defaultProps,"node-key":"id","default-checked-keys":e.checkedKeys,"show-checkbox":"","default-expand-all":"",onCheck:e.onCheck},null,8,["data","props","default-checked-keys","onCheck"])]),v("div",Ze,[o(l,{type:"primary",onClick:e.saveInfo},{default:t(()=>[ze]),_:1},8,["onClick"])])],64)}const Xe=N(He,[["render",Qe]]),Ye=A({components:{DepartLeftTree:Pe,DepartInfo:Ge,DepartRole:Xe},setup(){const e=c("info"),a=c(""),h=c([null]),d=c(!1),u=c(),D=c(),r=p=>{a.value=p.id,d.value=!0,u.value.setFormInfo(p),l(p.id)},l=p=>{pe({departId:p}).then(m=>{D.value.setCheckedKeys(m.data)})},n=c(!1);return(()=>{n.value=!0,h.value=[],fe().then(p=>{h.value=p.data,n.value=!1})})(),{loading:n,treeData:h,hasCheckNode:d,activeName:e,departId:a,departInfoRef:u,departPermissionRef:D,onSave:p=>{Z(p,!0).then(m=>{m.code===200?k({message:`${m.message}`,type:"success"}):k({message:`${m.message}`,type:"error"})})},onTreeSelect:r}}});const xe={class:"pt-10"};function eo(e,a,h,d,u,D){const r=F("DepartLeftTree"),l=re,n=F("DepartInfo"),s=te,C=F("DepartRole"),p=le,m=de,g=ne;return y(),V(g,{class:"p-4"},{default:t(()=>[o(l,{md:8,sm:24,xl:6},{default:t(()=>[o(r,{ref:"leftTree",loading:e.loading,"tree-data":e.treeData,onOnNodeClick:e.onTreeSelect},null,8,["loading","tree-data","onOnNodeClick"])]),_:1}),o(m,{header:"\u90E8\u95E8\u8BE6\u60C5",class:"ml-2 flex-1"},{default:t(()=>[P(o(p,{modelValue:e.activeName,"onUpdate:modelValue":a[0]||(a[0]=i=>e.activeName=i),class:"depart-tabs"},{default:t(()=>[o(s,{label:"\u57FA\u672C\u4FE1\u606F",name:"info"},{default:t(()=>[o(n,{ref:"departInfoRef","tree-data":e.treeData,onOnSave:e.onSave},null,8,["tree-data","onOnSave"])]),_:1}),o(s,{label:"\u90E8\u95E8\u6743\u9650",name:"role"},{default:t(()=>[o(C,{ref:"departPermissionRef","depart-id":e.departId},null,8,["depart-id"])]),_:1})]),_:1},8,["modelValue"]),[[K,e.hasCheckNode]]),P(v("div",xe,"\u5C1A\u672A\u9009\u62E9\u90E8\u95E8",512),[[K,e.hasCheckNode==!1]])]),_:1})]),_:1})}const Eo=N(Ye,[["render",eo],["__scopeId","data-v-0a1415f7"]]);export{Eo as default};
