var Q=Object.defineProperty,X=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var S=(e,t,o)=>t in e?Q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,m=(e,t)=>{for(var o in t||(t={}))Z.call(t,o)&&S(e,o,t[o]);if(C)for(var o of C(t))ee.call(t,o)&&S(e,o,t[o]);return e},w=(e,t)=>X(e,Y(t));import{e as L,aj as te,g as h,a1 as $,bP as oe,_ as k,o as b,c as _,a as p,dA as ne,A as z,aC as re,cG as se,N as W,dB as ie,H as ae,G as le,O as j,S as P,b as F,C as ue,h as ce}from"./index.d7d2c828.js";import{a as de}from"./index.cf99b79d.js";const fe=L({props:{url:{type:String,default:""},width:{type:String,default:"100%"}},emits:["loaded"],setup(e,{emit:t}){const o=te("lazy"),n=h(null);$(()=>{r()}),oe(()=>{l()});function r(){!n.value||o.mount(n.value,e.url,s=>{const{height:i,width:u}=s;t("loaded",{dom:n.value,src:e.url,width:u,height:i})})}function l(){!n.value||o.unmount(n.value)}return{lazyRef:n}}}),he={class:"lazy__box"},ye={ref:"lazyRef",class:"lazy__img"};function ge(e,t,o,n,r,l){return b(),_("div",he,[p("img",ye,null,512)])}var pe=k(fe,[["render",ge],["__scopeId","data-v-0e060bae"]]);const Ae=({breakpoints:e,wrapperWidth:t,gutter:o,hasAroundGutter:n,initWidth:r})=>{const l=Object.keys(e).map(c=>Number(c)).sort((c,g)=>c-g);let s=t,i=!1;for(const c of l)if(t<=c){s=c,i=!0;break}if(!i)return r;const u=e[s].rowPerView;return n?(t-o)/u-o:(t-(u-1)*o)/u};function me(e){const t=h(0),o=h(null);ne(o,s=>{const i=s[0],{width:u}=i.contentRect;t.value=u});const n=z(()=>Ae({wrapperWidth:t.value,breakpoints:e.breakpoints,gutter:e.gutter,hasAroundGutter:e.hasAroundGutter,initWidth:e.width})),r=z(()=>{const s=e.hasAroundGutter?-e.gutter:e.gutter;return Math.floor((t.value+s)/(n.value+e.gutter))}),l=z(()=>{const s=e.hasAroundGutter?e.gutter:-e.gutter,i=r.value*(n.value+e.gutter)+s;return(t.value-i)/2});return{waterfallWrapper:o,wrapperWidth:t,colWidth:n,cols:r,offsetX:l}}const we=typeof window!="undefined"&&window!==null,N=_e(),ve=Object.prototype.propertyIsEnumerable,G=Object.getOwnPropertySymbols;function be(e,...t){return t.map(n=>n.replace(/\[(\w+)\]/g,".$1").split(".").reduce((r,l)=>r&&r[l],e))}function _e(){return we&&"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype?("isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get(){return this.intersectionRatio>0}}),!0):!1}function I(e){return typeof e=="function"||toString.call(e)==="[object Object]"}function Ie(e){return typeof e=="object"?e===null:typeof e!="function"}function Oe(e){return e!=="__proto__"&&e!=="constructor"&&e!=="prototype"}function Ee(e,...t){if(!I(e))throw new TypeError("expected the first argument to be an object");if(t.length===0||typeof Symbol!="function"||typeof G!="function")return e;for(const o of t){const n=G(o);for(const r of n)ve.call(o,r)&&(e[r]=o[r])}return e}function J(e,...t){let o=0;for(Ie(e)&&(e=t[o++]),e||(e={});o<t.length;o++)if(I(t[o])){for(const n of Object.keys(t[o]))Oe(n)&&(I(e[n])&&I(t[o][n])?J(e[n],t[o][n]):e[n]=t[o][n]);Ee(e,t[o])}return e}function B(e,t=""){return new Promise((o,n)=>{const r=new Image;r.onload=()=>{o(r)},r.onerror=()=>{n(new Error("Image load error"))},t&&(r.crossOrigin=t&&"Anonymous"),r.src=e})}const ze={rootMargin:"0px",threshold:0},H="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",Le="";class ke{constructor(t=!0,o,n){this.lazyActive=!0,this.options={loading:H,error:Le,observerOptions:ze,log:!0},this._images=new WeakMap,this.lazyActive=t,this.colWidth=n.colWidth,this.colWidth,this.config(o)}config(t={}){J(this.options,t)}mount(t,o,n){const{src:r,loading:l,error:s}=this._valueFormatter(o);if(t.setAttribute("lazy","loading"),t.setAttribute("src",l||H),!this.lazyActive)this._setImageSrc(t,r,n,s);else{if(!N){debugger;this._setImageSrc(t,r,n,s),this._log(()=>{throw new Error("Not support IntersectionObserver!")})}this._initIntersectionObserver(t,r,n,s)}}resize(t,o){const n=t.getAttribute("lazy"),r=t.getAttribute("src");n&&n==="loaded"&&r&&B(r).then(l=>{const{width:s,height:i}=l,u=this.colWidth/s*i;t.height=u;const c=t.style;c.height=`${u}px`,o({width:s,height:i})})}unmount(t){const o=this._realObserver(t);o&&o.unobserve(t),this._images.delete(t)}_setImageSrc(t,o,n,r){!o||t.getAttribute("src")===o||B(o).then(s=>{t.setAttribute("lazy","loaded"),t.removeAttribute("src"),t.setAttribute("src",o);const{width:i,height:u}=s,c=this.colWidth/i*u;t.height=c;const g=t.style;g.height=`${c}px`,n({width:i,height:u})}).catch(()=>{const s=this._realObserver(t);s&&s.disconnect(),r&&(t.setAttribute("lazy","error"),t.setAttribute("src",r)),this._log(()=>{throw new Error(`Image failed to load!And failed src was: ${o} `)}),n()})}_isOpenLazy(){return N&&this.lazyActive}_initIntersectionObserver(t,o,n,r){const l=this.options.observerOptions;this._images.set(t,new IntersectionObserver(i=>{Array.prototype.forEach.call(i,u=>{if(u.isIntersecting){const c=this._realObserver(t);c&&c.unobserve(u.target),this._setImageSrc(t,o,n,r)}})},l));const s=this._realObserver(t);s&&s.observe(t)}_valueFormatter(t){let o=t,n=this.options.loading,r=this.options.error;return I(t)&&(o=t.src,n=t.loading||this.options.loading,r=t.error||this.options.error),{src:o,loading:n,error:r}}_log(t){this.options.log&&t()}_realObserver(t){return this._images.get(t)}}const R=L({props:{list:{type:Array,default:()=>[]},rowKey:{type:String,default:"id"},imgSelector:{type:String,default:"src"},width:{type:Number,default:200},breakpoints:{type:Object,default:()=>({1200:{rowPerView:3},800:{rowPerView:2},500:{rowPerView:1}})},gutter:{type:Number,default:10},hasAroundGutter:{type:Boolean,default:!0},animationPrefix:{type:String,default:"animate__animated"},animationEffect:{type:String,default:"fade-in"},animationDuration:{type:Number,default:1e3},animationDelay:{type:Number,default:300},backgroundColor:{type:String,default:"#fff"},lazyload:{type:Boolean,default:!0},loadProps:{type:Object,default:()=>{}},delay:{type:Number,default:300}},setup(e){const t=h(e.list.map(a=>w(m({},a),{ref:h(null)}))),o=h(0),{waterfallWrapper:n,wrapperWidth:r,colWidth:l,cols:s,offsetX:i}=me(e),u=h([]),c=new ke(e.lazyload,e.loadProps,{colWidth:l.value});re("lazy",c);const g=se(async()=>{u.value=new Array(s.value).fill(e.hasAroundGutter?e.gutter:0),t.value.forEach(a=>{x(a)}),o.value=Math.max.apply(null,u.value)},e.delay);W(()=>[r,l],()=>{g()},{deep:!0}),W(()=>e.list,()=>{const a=t.value.map(d=>O(d)),f=e.list.map(d=>O(d)),y=e.list.filter(d=>!a.includes(d.src));t.value.push(...y.map(d=>w(m({},d),{ref:h(null)}))),t.value=t.value.filter(d=>f.includes(d.src)),g()},{deep:!0});const M=a=>{const f=e.hasAroundGutter?a+1:a;return e.gutter*f+l.value*a+i.value},x=async a=>{var D,V;const f=Math.min.apply(null,u.value),y=u.value.indexOf(f),d=M(y);a.style=w(m({},a.style),{transform:`translate3d(${d}px,${f}px, 0)`,width:`${l.value}px`});const E=a.width||((D=a.ref)==null?void 0:D.clientWidth),v=a.height||((V=a.ref)==null?void 0:V.clientHeight),A=l.value/E*v||0;u.value[y]+=A+e.gutter,q(a,()=>{a.style=w(m({},a.style),{transition:".3s"})})},T=a=>be(a,e.imgSelector)[0],O=(a,f)=>a[e.rowKey]||a.src||f||a;function q(a,f){const y=`${e.animationDuration/1e3}s`,d=`${e.animationDelay/1e3}s`;a.style=w(m({},a.style),{visibility:"visible",duration:y,delay:d,fillMode:"both"}),a.cls=`${e.animationPrefix} ${e.animationEffect}`,f&&setTimeout(()=>{f()},e.animationDuration+e.animationDelay)}return{waterfallWrapper:n,wrapperHeight:o,getRenderURL:T,getKey:O,handleLoaded:a=>{const{dom:f,src:y,width:d,height:E}=a;for(let v=0;v<t.value.length;v++){const A=t.value[v];if(A.src===y){A.dom=f,A.width=d,A.height=E;break}}g()},newLists:t}}}),K=()=>{ie(e=>({c3a98f92:e.backgroundColor}))},U=R.setup;R.setup=U?(e,t)=>(K(),U(e,t)):K;const Re=R,De={class:"bg-gray-900 rounded-lg shadow-md overflow-hidden transition-all duration-300 ease-linear hover:shadow-lg hover:shadow-gray-600 group"},Ve={class:"overflow-hidden"};function Ce(e,t,o,n,r,l){const s=pe;return b(),_("ul",{ref:"waterfallWrapper",class:"waterfall-list",style:j({height:`${e.wrapperHeight}px`})},[(b(!0),_(ae,null,le(e.newLists,(i,u)=>(b(),_("li",{key:e.getKey(i,u),ref_for:!0,ref:c=>i.ref=c,class:"waterfall-item",style:j(i.style)},[p("div",{class:ue(["waterfall-card",i==null?void 0:i.cls])},[P(e.$slots,"item",{item:i,index:u},()=>[p("div",De,[p("div",Ve,[F(s,{url:i.src,class:"cursor-pointer transition-all duration-300 ease-linear group-hover:scale-105",onLoaded:e.handleLoaded},null,8,["url","onLoaded"])])])],!0),P(e.$slots,"default",{},void 0,!0)],2)],4))),128))],4)}var Se=k(Re,[["render",Ce],["__scopeId","data-v-65b7481a"]]),We="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAABN9JREFUaEPtWM1rJEUUf69nujebjUFDj7FqZggBkUWiKJkIYf0C2Yuag5f8AyKukMU9eRA0m1VYvLkeJKKehYigRg8ushFWjZgEFj0Y9JBDJtU9M00UiTGZ7uknJdMy29Ofk5noyBb0pevV771fvVev3iuEPh/Y5/bDLQL/tge75gHDMKaI6BkAeAwA7mh+tzcJ/gYAv8qPiL5wXffjYrH4QzfIH4mAZVn5er1+joieRsQH0hhERN8h4peapi3qur6TZm2rbEcEarUadxxHGv4cANzVqfLmOhMR381ms4u5XE6kxUpNQAhxDgDmu2C431YTAN7gnL+ZhkQqAkIICf5iGgVpZRHxQ8bYbNJ1iQiUy+V7FEV5DwAeSQp8RLky57yYBCMRAcMw5onoYgLAb4jomqqqVwHA3N3drcg1IyMjozLkbNs+oyjKWSJ6Ig4LEX9kjN0fKxcnQESaEGIdEe+LkH0fEd9hjK3F4cn5Zsp9HgCejZJHxIuMsYVImajJ9fV1dWxsbMC27WsAUPLLIuJXAPBSUsP965tE3g7C9mRlpsvn8zJ8A0doCBERViqVwUwmoziOU5Kh4UOQO34eEe0kux4lI4T4HACeDJExVVWdDEuxUQQ0y7JOeKCO45x2XfcyIrqIeIUxJpV2bRiG8RYRnQ8CRMTXGGOvBs4F/SQipVarDSJiG8GDgwOnWCz+2TXLW4AMw/iUiGYCsE1N00pBN3agB4johGVZWpCRKysr+7Ozs40eEZD11Pch2K9zzl9pO4dBwqZpnpKx75/b29uzx8fHD3phvIcphJAHNig73eCcPxhLYH5+Xpmbmzt13Lvv6WtmpkAvIOJD/ozXFkJe6vQTsG27wTnf7+Xut3jhawA4E6DrMuf85db/bQTC4l/X9UNErB8HAcMwLhFRW7wDwLec85uItRHY3t4+OTAwkPUbquv6PiL25PD6dVWr1Ycdx7kesFk/cc7vjfRA2AHWdf0PeQcchweq1erdjuP8EpROOecskkC1Wh0Kyv+6ru8hIh0Hgc3NzduGh4d/D9B1wDk/+f8m0Pch1PeHOCyNViqVw4mJiWNJozs7O5cQsbM0GnaR6bruIGJPijj/YRVCHOkiQ8uyhvq2lJCGCyEGVVXN/JeKOSK6kc/n44s5aXTfl9NRDU2vijoiUk3TvEpEjwfdwKkamqYXbmopW0F70ZUJIRYBQL5UtI3ULWWTwD9NfRCorut1RDzsRmlhGMZTRPRZCFZnTb0EC0upniLpidXV1XqnLebS0lJmenpay2QynwDA2RACL3DOpXcCR+zL3NbW1sDQ0JAatdOy1VxbW7OTEpGGT01NqR5u2LsTAFzhnF+I0h1LQC4Oq4/8wPKAM8YcAJB9g6xcvepV6pFfxjCMrD9Fh7w7XeecPxoXookIRN0NcQqSznvvTgBwp6IoHzUajQ8KhcLPcesTE4jLTHGKks6nbV1TEfAOdqFQkAev7dklqZFBco1Gwy2Xy/VSqZTqqTI1AS/FAoBaq9W0oO4tDREiolwuJ6tcu5OOryMCnoHyxpZEKpVKNq1H5I6Pjo7KAy8N77jXPhKB1p2WD2IzMzOZyclJpVwuK6qqKoqi/I3vui7Ztu0WCgV3Y2PDXV5ebiwsLHRsdKverhFIEzbdlL1FoJu72QlW33vgL+ntak98Gx9aAAAAAElFTkSuQmCC";const je=L({setup(){async function e(){const l=[];try{const s=await de.get("/api/public/mix");if(s.status===200){const i=s.data;i.code===200&&l.push(...i.data||[])}}catch(s){}return l}function t(){const l=h([]),s=ce({rowKey:"id",gutter:10,hasAroundGutter:!0,width:320,breakpoints:{1200:{rowPerView:4},800:{rowPerView:3},500:{rowPerView:2}},animationEffect:"animate__fadeInUp",animationDuration:1e3,animationDelay:300,backgroundColor:"#2C2E3A",imgSelector:"src.original",loadProps:{loading:We},lazyload:!0});$(async()=>{await i()});async function i(){(await e()).map(c=>{l.value.push({src:c})})}return{list:l,options:s,handleLoadMore:i}}const{list:o,options:n,handleLoadMore:r}=t();return{list:o,options:n,handleLoadMore:r}}}),Pe={class:"h-screen flex overflow-hidden"},Ne={class:"flex-auto overflow-y-auto"},Ge={class:"flex justify-center py-10 bg-gray-900"};function Be(e,t,o,n,r,l){const s=Se;return b(),_("div",Pe,[p("div",Ne,[F(s,{list:e.list,"row-key":e.options.rowKey,gutter:e.options.gutter,"has-around-gutter":e.options.hasAroundGutter,width:e.options.width,breakpoints:e.options.breakpoints,"img-selector":e.options.imgSelector,"background-color":e.options.backgroundColor,"animation-effect":e.options.animationEffect,"animation-duration":e.options.animationDuration,"animation-delay":e.options.animationDelay,lazyload:e.options.lazyload,"load-props":e.options.loadProps},null,8,["list","row-key","gutter","has-around-gutter","width","breakpoints","img-selector","background-color","animation-effect","animation-duration","animation-delay","lazyload","load-props"]),p("div",Ge,[p("button",{class:"px-5 py-2 rounded-full bg-gray-700 text-md text-white cursor-pointer hover:bg-gray-800 transition-all duration-300",onClick:t[0]||(t[0]=(...i)=>e.handleLoadMore&&e.handleLoadMore(...i))},"\u52A0\u8F7D\u66F4\u591A")])])])}var Fe=k(je,[["render",Be]]);export{Fe as default};
