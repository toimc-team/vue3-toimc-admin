import{ai as d,e as j,g as D,R as S,_ as O,l as z,j as P,w as t,o as g,a as k,b as o,a7 as G,k as y,h as H,b9 as J,e7 as Z,E as F,M as Q,Z as W,D as X,O as Y,K as x,a0 as ee,ea as ae,r as N,t as re,c as R,J as $,H as oe,I as T}from"./index.6b8e7d20.js";/* empty css                       *//* empty css                 */import{E as se}from"./el-upload.d752c630.js";import"./el-progress.9ee01ca6.js";import{v as te}from"./el-loading.e2386137.js";/* empty css                  */import{E as ue}from"./el-tree.1ec89225.js";import"./el-checkbox.2f84ff2b.js";import{q as le}from"./depart.4ce17f40.js";import{E as ne}from"./index.12b7b927.js";import{E as de,b as ie}from"./index.b365a39d.js";const w={authorization:"Bearer "+localStorage.getItem("token")},Je=e=>new Promise(a=>{d.get("/api/sys/user/userRoleList",{params:e,headers:w}).then(r=>{a(r.data)})}),me=e=>new Promise(a=>{d.get("/api/sys/user/queryUserRole",{params:e,headers:w}).then(r=>{a(r.data)})}),Ze=e=>new Promise(a=>{d.delete("/api/sys/user/deleteBatch",{data:e,headers:w}).then(r=>{a(r.data)})}),Qe=e=>new Promise(a=>{d.delete("/api/sys/user/deleteUserRoleBatch",{data:e,headers:w}).then(r=>{a(r.data)})}),pe=e=>new Promise(a=>{d.put("/api/sys/user/edit",e,{headers:w}).then(r=>{a(r.data)})}),We=e=>new Promise(a=>{d.put("/api/sys/user/resetPassword",e,{headers:w}).then(r=>{a(r.data)})}),Xe=e=>new Promise(a=>{d.put("/api/sys/user/frozenBatch",e,{headers:w}).then(r=>{a(r.data)})}),Ye=e=>new Promise(a=>{d.get("/api/sys/user/list",{params:e,headers:w}).then(r=>{a(r.data)})}),fe=e=>new Promise(a=>{d.post("/api/sys/user/add",e,{headers:w}).then(r=>{a(r.data)})}),v={authorization:"Bearer "+localStorage.getItem("token")},xe=()=>new Promise(e=>{d.get("/api/sys/role/queryTreeList",{headers:v}).then(a=>{e(a.data)})}),ea=e=>new Promise(a=>{const r={roleId:e};d.get("/api/sys/permission/queryRolePermission",{params:r,headers:v}).then(m=>{a(m.data)})}),ce=()=>new Promise(e=>{d.get("/api/sys/role/queryAll",{headers:v}).then(a=>{e(a.data)})}),aa=e=>new Promise(a=>{d.get("/api/sys/role/list",{params:e,headers:v}).then(r=>{a(r.data)})}),ra=e=>new Promise(a=>{d.delete("/api/sys/role/delete",{data:e,headers:v}).then(r=>{a(r.data)})}),oa=e=>new Promise(a=>{d.delete("/api/sys/role/deleteBatch",{data:e,headers:v}).then(r=>{a(r.data)})}),sa=(e,a)=>a?new Promise(r=>{d.put("/api/sys/role/edit",e,{headers:v}).then(m=>{r(m.data)})}):new Promise(r=>{d.post("/api/sys/role/add",e,{headers:v}).then(m=>{r(m.data)})}),ta=e=>new Promise(a=>{d.post("/api/sys/permission/saveRolePermission",e,{headers:v}).then(r=>{a(r.data)})}),he=j({props:{show:{type:Boolean,default:!1},checkedKeys:{type:String,default:""}},emits:["close","confirm","loadTreeData"],setup(e,{emit:a}){const r={children:"children",label:"departName",value:"id"},m=D(!1),i=D([]),c=D();(()=>{m.value=!0,le().then(f=>{i.value=f.data,m.value=!1,a("loadTreeData",f.data)})})();const n=()=>{a("close")},_=()=>{let f=c.value.getCheckedNodes(!1,!0);n(),a("confirm",f)};return S(()=>e.show,f=>{if(f){let E=e.checkedKeys.split(",");E.length>0&&setTimeout(()=>{c.value,c.value.setCheckedKeys(E)},100)}},{immediate:!0}),{defaultProps:r,treeData:i,treeDepartRef:c,loading:m,close:n,onConfirm:_}}}),ge={class:"overflow-auto",style:{height:"340px"}},De={class:"dialog-footer flex justify-end"},ve=y("\u53D6\u6D88"),ye=y("\u786E\u8BA4");function we(e,a,r,m,i,c){const p=ue,n=z,_=ne,f=te;return g(),P(_,{"model-value":e.show,title:"\u9009\u62E9\u90E8\u95E8",center:"",width:"400px",onClose:e.close},{footer:t(()=>[k("span",De,[o(n,{onClick:e.close},{default:t(()=>[ve]),_:1},8,["onClick"]),o(n,{type:"primary",onClick:e.onConfirm},{default:t(()=>[ye]),_:1},8,["onClick"])])]),default:t(()=>[k("div",ge,[G(o(p,{ref:"treeDepartRef","default-expand-all":"",data:e.treeData,"show-checkbox":"","node-key":"id","check-strictly":"",props:e.defaultProps},null,8,["data","props"]),[[f,e.loading]])])]),_:1},8,["model-value","onClose"])}const Be=O(he,[["render",we]]),Fe=j({components:{PickDepart:Be},props:{show:{type:Boolean,default:!1},roleId:{type:String,default:null},user:{type:Object,default:()=>({})}},emits:["close"],setup(e,a){const r=D(),m=D(!1),i=D({username:"",password:"",confirmPassword:"",realname:"",avatar:"",phone:"",workNo:"",roleIds:"",departIds:"",roleIdsArr:[],departIdsArr:[],sex:"",status:""}),c=D([]),p=D([]);(()=>{ce().then(u=>{u.code===0&&(c.value=u.data.records||[])})})();const f=H({username:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u8D26\u53F7",trigger:"blur"},{min:3,max:10,message:"\u957F\u5EA6\u57283-10\u4E4B\u95F4",trigger:"blur"}],password:[{required:!0,message:"\u8BF7\u8F93\u5165\u767B\u5F55\u5BC6\u7801",trigger:"blur"}],confirmPassword:[{required:!0,message:"\u8BF7\u518D\u6B21\u8F93\u5165\u5BC6\u7801",trigger:"blur"},{validator:(u,l,B)=>{l===""?B(new Error("\u8BF7\u518D\u6B21\u8F93\u5165\u5BC6\u7801")):l!==i.value.password?B(new Error("\u4E24\u6B21\u8F93\u5165\u7684\u5BC6\u7801\u4E0D\u5339\u914D!")):B()},trigger:"blur"}],realname:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u59D3\u540D",trigger:"blur"}],phone:[{required:!0,message:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7",trigger:"blur"}],workNo:[{required:!0,message:"\u8BF7\u8F93\u5165\u5DE5\u53F7",trigger:"blur"}]}),E=u=>{u.code===0?i.value.avatar=u.data:F.error(u.message)},I=u=>{if(u.type==="image/jpeg"||u.type==="image/png"){if(u.size/1024/1024>2)return F.error("\u6587\u4EF6\u4E0D\u80FD\u8D85\u8FC7 2MB!"),!1}else return F.error("\u4E0A\u6B21\u5934\u50CF\u7C7B\u578B\u4E3Apng\u6216\u8005jpg\u683C\u5F0F\u6587\u4EF6"),!1;return!0},A=u=>{let l=u||[],B=[];l.forEach(q=>{B.push(q),q.children&&q.children.forEach(M=>{B.push(M)})}),p.value=B},C=()=>{if(!e.user.id){e.roleId&&(i.value.roleIds=e.roleId,i.value.roleIdsArr=[e.roleId]);return}let u={userId:e.user.id};me(u).then(l=>{l.code===0&&(i.value.roleIdsArr=l.data,i.value.roleIds=l.data.join(",")||"")})},b=u=>{p.value=u,i.value.departIds=u.map(l=>l.id).join(","),i.value.departIdsArr=u.map(l=>l.id)},V=()=>{i.value={id:e.user.id,username:e.user.username,realname:e.user.realname,avatar:e.user.avatar||"",phone:e.user.phone,workNo:e.user.workNo,roleIds:"",roleIdsArr:[],departIds:e.user.departIds||"",departIdsArr:e.user.departIds?e.user.departIds.split(","):[],sex:e.user.sex?e.user.sex:0,status:e.user.status},C()},U=async u=>{!u||await u.validate((l,B)=>{l&&(e.user.id?s():L())})},h=D(!1),L=()=>{if(h.value)return;const u={...i.value};h.value=!0,fe(u).then(l=>{h.value=!1,l.code===0?F.success("\u6DFB\u52A0\u6210\u529F"):F.error(l.message)})},s=()=>{if(h.value)return;const u={...i.value};h.value=!0,pe(u).then(l=>{h.value=!1,l.code===0?F.success("\u4FEE\u6539\u6210\u529F"):F.error(l.message)})},K=()=>{a.emit("close")};return S(()=>e.show,u=>{u&&V()},{immediate:!0}),{Search:J,Refresh:Z,ruleFormRef:r,rules:f,formData:i,roleList:c,departList:p,showPickDepart:m,isEditLoading:h,onClose:K,submitForm:U,handleAvatarSuccess:E,beforeAvatarUpload:I,onConfirmDepart:b,onLoadTreeData:A}}});const _e={class:"divide-y divide-gray-500/50"},Ee={class:"p-4"},be=["src"],ke=y(" \u9009\u62E9\u90E8\u95E8 "),Ce=y(" \u7537 "),Pe=y(" \u5973 "),Ie=y(" \u6B63\u5E38 "),Ae=y(" \u51BB\u7ED3 "),Ve={class:"flex justify-end"},Re=y(" \u53D6\u6D88 "),Ue=y(" \u786E\u8BA4 ");function Le(e,a,r,m,i,c){const p=Q,n=W,_=N("Plus"),f=X,E=se,I=Y,A=x,C=z,b=de,V=ie,U=ee,h=N("pick-depart"),L=ae;return g(),P(L,{"model-value":e.show,direction:"rtl",size:"604px",onClose:e.onClose},{title:t(()=>[k("h4",_e,[k("span",null,re(e.user.id?"\u7F16\u8F91":"\u65B0\u589E")+"\u7528\u6237",1)])]),default:t(()=>[k("div",Ee,[o(U,{ref:"ruleFormRef",model:e.formData,rules:e.rules,"label-width":"90px","label-position":"right"},{default:t(()=>[o(n,{label:"\u7528\u6237\u8D26\u53F7",prop:"username"},{default:t(()=>[o(p,{modelValue:e.formData.username,"onUpdate:modelValue":a[0]||(a[0]=s=>e.formData.username=s),disabled:!!e.user.id,placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u8D26\u53F7"},null,8,["modelValue","disabled"])]),_:1}),e.user.id?oe("",!0):(g(),R($,{key:0},[o(n,{label:"\u767B\u5F55\u5BC6\u7801",prop:"password"},{default:t(()=>[o(p,{modelValue:e.formData.password,"onUpdate:modelValue":a[1]||(a[1]=s=>e.formData.password=s),type:"password",placeholder:"\u8BF7\u8F93\u5165\u767B\u5F55\u5BC6\u7801"},null,8,["modelValue"])]),_:1}),o(n,{label:"\u786E\u8BA4\u5BC6\u7801",prop:"confirmPassword"},{default:t(()=>[o(p,{modelValue:e.formData.confirmPassword,"onUpdate:modelValue":a[2]||(a[2]=s=>e.formData.confirmPassword=s),type:"password",placeholder:"\u8BF7\u8F93\u5165\u786E\u8BA4\u5BC6\u7801"},null,8,["modelValue"])]),_:1})],64)),o(n,{label:"\u7528\u6237\u59D3\u540D",prop:"realname"},{default:t(()=>[o(p,{modelValue:e.formData.realname,"onUpdate:modelValue":a[3]||(a[3]=s=>e.formData.realname=s),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u59D3\u540D"},null,8,["modelValue"])]),_:1}),o(n,{label:"\u5934\u50CF",prop:"avatar"},{default:t(()=>[o(E,{class:"avatar-uploader border border-gray-100",action:"/api/sys/common/upload","show-file-list":!1,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload},{default:t(()=>[e.formData.avatar?(g(),R("img",{key:0,src:e.formData.avatar,class:"avatar"},null,8,be)):(g(),P(f,{key:1,class:"avatar-uploader-icon"},{default:t(()=>[o(_)]),_:1}))]),_:1},8,["on-success","before-upload"])]),_:1}),o(n,{label:"\u624B\u673A\u53F7",prop:"phone"},{default:t(()=>[o(p,{modelValue:e.formData.phone,"onUpdate:modelValue":a[4]||(a[4]=s=>e.formData.phone=s),placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7"},null,8,["modelValue"])]),_:1}),o(n,{label:"\u5DE5\u53F7",prop:"workNo"},{default:t(()=>[o(p,{modelValue:e.formData.workNo,"onUpdate:modelValue":a[5]||(a[5]=s=>e.formData.workNo=s),placeholder:"\u8BF7\u8F93\u5165\u5DE5\u53F7"},null,8,["modelValue"])]),_:1}),o(n,{label:"\u89D2\u8272"},{default:t(()=>[o(A,{modelValue:e.formData.roleIdsArr,"onUpdate:modelValue":a[6]||(a[6]=s=>e.formData.roleIdsArr=s),multiple:"",placeholder:"\u8BF7\u9009\u62E9\u89D2\u8272",style:{width:"100%"}},{default:t(()=>[(g(!0),R($,null,T(e.roleList,s=>(g(),P(I,{key:s.id,label:s.roleName,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(n,{label:"\u6240\u5C5E\u90E8\u95E8"},{default:t(()=>[o(A,{modelValue:e.formData.departIdsArr,"onUpdate:modelValue":a[7]||(a[7]=s=>e.formData.departIdsArr=s),style:{width:"340px","margin-right":"4px"},disabled:"",multiple:"",placeholder:"\u8BF7\u9009\u62E9\u90E8\u95E8"},{default:t(()=>[(g(!0),R($,null,T(e.departList,s=>(g(),P(I,{key:s.id,label:s.departName,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(C,{type:"primary",onClick:a[8]||(a[8]=s=>e.showPickDepart=!0)},{default:t(()=>[ke]),_:1})]),_:1}),o(n,{label:"\u6027\u522B"},{default:t(()=>[o(V,{modelValue:e.formData.sex,"onUpdate:modelValue":a[9]||(a[9]=s=>e.formData.sex=s)},{default:t(()=>[o(b,{label:"1"},{default:t(()=>[Ce]),_:1}),o(b,{label:"2"},{default:t(()=>[Pe]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(n,{label:"\u72B6\u6001"},{default:t(()=>[o(V,{modelValue:e.formData.status,"onUpdate:modelValue":a[10]||(a[10]=s=>e.formData.status=s)},{default:t(()=>[o(b,{label:"1"},{default:t(()=>[Ie]),_:1}),o(b,{label:"0"},{default:t(()=>[Ae]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),k("div",Ve,[o(C,{onClick:e.onClose},{default:t(()=>[Re]),_:1},8,["onClick"]),o(C,{type:"primary",loading:e.isEditLoading,onClick:a[11]||(a[11]=s=>e.submitForm(e.ruleFormRef))},{default:t(()=>[Ue]),_:1},8,["loading"])])]),o(h,{show:e.showPickDepart,"checked-keys":e.formData.departIds,onClose:a[12]||(a[12]=s=>e.showPickDepart=!1),onConfirm:e.onConfirmDepart,onLoadTreeData:e.onLoadTreeData},null,8,["show","checked-keys","onConfirm","onLoadTreeData"])]),_:1},8,["model-value","onClose"])}const ua=O(Fe,[["render",Le],["__scopeId","data-v-46b008c7"]]);export{ua as A,xe as a,ea as b,sa as c,Ze as d,Qe as e,Xe as f,Je as g,aa as h,ra as i,oa as j,Ye as q,We as r,ta as s};
