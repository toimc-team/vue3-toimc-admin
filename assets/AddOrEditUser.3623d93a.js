var Z=Object.defineProperty;var T=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var j=(e,a,r)=>a in e?Z(e,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[a]=r,$=(e,a)=>{for(var r in a||(a={}))Q.call(a,r)&&j(e,r,a[r]);if(T)for(var r of T(a))W.call(a,r)&&j(e,r,a[r]);return e};import{ai as n,e as O,g as D,R as K,_ as M,o as g,j as P,w as s,a as k,b as o,a7 as X,k as w,l as G,h as Y,e3 as x,e4 as ee,E as _,r as S,e8 as ae,t as re,c as R,J as N,H as oe,I as z,M as te,Z as se,D as le,O as ue,K as de,a0 as ne}from"./index.26463cbc.js";/* empty css                       *//* empty css                 */import{E as ie}from"./el-upload.a8348934.js";import"./el-progress.307279fd.js";import{v as me}from"./el-loading.1ce21f00.js";/* empty css                  */import{E as pe}from"./el-tree.35d50e0b.js";import"./el-checkbox.353fb441.js";import{q as fe}from"./depart.b626be5d.js";import{E as ce}from"./index2.c533c4e5.js";import{E as he,b as ve}from"./index2.5d2be9ed.js";const B={authorization:"Bearer "+localStorage.getItem("token")},ea=e=>new Promise(a=>{n.get("/api/sys/user/userRoleList",{params:e,headers:B}).then(r=>{a(r.data)})}),ge=e=>new Promise(a=>{n.get("/api/sys/user/queryUserRole",{params:e,headers:B}).then(r=>{a(r.data)})}),aa=e=>new Promise(a=>{n.delete("/api/sys/user/deleteBatch",{data:e,headers:B}).then(r=>{a(r.data)})}),ra=e=>new Promise(a=>{n.delete("/api/sys/user/deleteUserRoleBatch",{data:e,headers:B}).then(r=>{a(r.data)})}),De=e=>new Promise(a=>{n.put("/api/sys/user/edit",e,{headers:B}).then(r=>{a(r.data)})}),oa=e=>new Promise(a=>{n.put("/api/sys/user/resetPassword",e,{headers:B}).then(r=>{a(r.data)})}),ta=e=>new Promise(a=>{n.put("/api/sys/user/frozenBatch",e,{headers:B}).then(r=>{a(r.data)})}),sa=e=>new Promise(a=>{n.get("/api/sys/user/list",{params:e,headers:B}).then(r=>{a(r.data)})}),ye=e=>new Promise(a=>{n.post("/api/sys/user/add",e,{headers:B}).then(r=>{a(r.data)})}),y={authorization:"Bearer "+localStorage.getItem("token")},la=()=>new Promise(e=>{n.get("/api/sys/role/queryTreeList",{headers:y}).then(a=>{e(a.data)})}),ua=e=>new Promise(a=>{const r={roleId:e};n.get("/api/sys/permission/queryRolePermission",{params:r,headers:y}).then(m=>{a(m.data)})}),we=()=>new Promise(e=>{n.get("/api/sys/role/queryAll",{headers:y}).then(a=>{e(a.data)})}),da=e=>new Promise(a=>{n.get("/api/sys/role/list",{params:e,headers:y}).then(r=>{a(r.data)})}),na=e=>new Promise(a=>{n.delete("/api/sys/role/delete",{data:e,headers:y}).then(r=>{a(r.data)})}),ia=e=>new Promise(a=>{n.delete("/api/sys/role/deleteBatch",{data:e,headers:y}).then(r=>{a(r.data)})}),ma=(e,a)=>a?new Promise(r=>{n.put("/api/sys/role/edit",e,{headers:y}).then(m=>{r(m.data)})}):new Promise(r=>{n.post("/api/sys/role/add",e,{headers:y}).then(m=>{r(m.data)})}),pa=e=>new Promise(a=>{n.post("/api/sys/permission/saveRolePermission",e,{headers:y}).then(r=>{a(r.data)})}),Be=O({props:{show:{type:Boolean,default:!1},checkedKeys:{type:String,default:""}},emits:["close","confirm","loadTreeData"],setup(e,{emit:a}){const r={children:"children",label:"departName",value:"id"},m=D(!1),i=D([]),c=D();(()=>{m.value=!0,fe().then(f=>{i.value=f.data,m.value=!1,a("loadTreeData",f.data)})})();const d=()=>{a("close")},F=()=>{let f=c.value.getCheckedNodes(!1,!0);d(),a("confirm",f)};return K(()=>e.show,f=>{if(f){let E=e.checkedKeys.split(",");E.length>0&&setTimeout(()=>{c.value,c.value.setCheckedKeys(E)},100)}},{immediate:!0}),{defaultProps:r,treeData:i,treeDepartRef:c,loading:m,close:d,onConfirm:F}}}),_e={class:"overflow-auto",style:{height:"340px"}},Fe={class:"dialog-footer flex justify-end"},Ee=w("\u53D6\u6D88"),be=w("\u786E\u8BA4");function ke(e,a,r,m,i,c){const p=pe,d=G,F=ce,f=me;return g(),P(F,{"model-value":e.show,title:"\u9009\u62E9\u90E8\u95E8",center:"",width:"400px",onClose:e.close},{footer:s(()=>[k("span",Fe,[o(d,{onClick:e.close},{default:s(()=>[Ee]),_:1},8,["onClick"]),o(d,{type:"primary",onClick:e.onConfirm},{default:s(()=>[be]),_:1},8,["onClick"])])]),default:s(()=>[k("div",_e,[X(o(p,{ref:"treeDepartRef","default-expand-all":"",data:e.treeData,"show-checkbox":"","node-key":"id","check-strictly":"",props:e.defaultProps},null,8,["data","props"]),[[f,e.loading]])])]),_:1},8,["model-value","onClose"])}var Ce=M(Be,[["render",ke]]);const Pe=O({components:{PickDepart:Ce},props:{show:{type:Boolean,default:!1},roleId:{type:String,default:null},user:{type:Object,default:()=>({})}},emits:["close"],setup(e,a){const r=D(),m=D(!1),i=D({username:"",password:"",confirmPassword:"",realname:"",avatar:"",phone:"",workNo:"",roleIds:"",departIds:"",roleIdsArr:[],departIdsArr:[],sex:"",status:""}),c=D([]),p=D([]);(()=>{we().then(l=>{l.code===0&&(c.value=l.data.records||[])})})();const f=Y({username:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u8D26\u53F7",trigger:"blur"},{min:3,max:10,message:"\u957F\u5EA6\u57283-10\u4E4B\u95F4",trigger:"blur"}],password:[{required:!0,message:"\u8BF7\u8F93\u5165\u767B\u5F55\u5BC6\u7801",trigger:"blur"}],confirmPassword:[{required:!0,message:"\u8BF7\u518D\u6B21\u8F93\u5165\u5BC6\u7801",trigger:"blur"},{validator:(l,u,v)=>{u===""?v(new Error("\u8BF7\u518D\u6B21\u8F93\u5165\u5BC6\u7801")):u!==i.value.password?v(new Error("\u4E24\u6B21\u8F93\u5165\u7684\u5BC6\u7801\u4E0D\u5339\u914D!")):v()},trigger:"blur"}],realname:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u59D3\u540D",trigger:"blur"}],phone:[{required:!0,message:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7",trigger:"blur"}],workNo:[{required:!0,message:"\u8BF7\u8F93\u5165\u5DE5\u53F7",trigger:"blur"}]}),E=l=>{l.code===0?i.value.avatar=l.data:_.error(l.message)},I=l=>{if(l.type==="image/jpeg"||l.type==="image/png"){if(l.size/1024/1024>2)return _.error("\u6587\u4EF6\u4E0D\u80FD\u8D85\u8FC7 2MB!"),!1}else return _.error("\u4E0A\u6B21\u5934\u50CF\u7C7B\u578B\u4E3Apng\u6216\u8005jpg\u683C\u5F0F\u6587\u4EF6"),!1;return!0},A=l=>{let u=l||[],v=[];u.forEach(q=>{v.push(q),q.children&&q.children.forEach(J=>{v.push(J)})}),p.value=v},C=()=>{if(!e.user.id){e.roleId&&(i.value.roleIds=e.roleId,i.value.roleIdsArr=[e.roleId]);return}let l={userId:e.user.id};ge(l).then(u=>{u.code===0&&(i.value.roleIdsArr=u.data,i.value.roleIds=u.data.join(",")||"")})},b=l=>{p.value=l,i.value.departIds=l.map(u=>u.id).join(","),i.value.departIdsArr=l.map(u=>u.id)},V=()=>{i.value={id:e.user.id,username:e.user.username,realname:e.user.realname,avatar:e.user.avatar||"",phone:e.user.phone,workNo:e.user.workNo,roleIds:"",roleIdsArr:[],departIds:e.user.departIds||"",departIdsArr:e.user.departIds?e.user.departIds.split(","):[],sex:e.user.sex?e.user.sex:0,status:e.user.status},C()},U=async l=>{!l||await l.validate((u,v)=>{u&&(e.user.id?t():L())})},h=D(!1),L=()=>{if(h.value)return;const l=$({},i.value);h.value=!0,ye(l).then(u=>{h.value=!1,u.code===0?_.success("\u6DFB\u52A0\u6210\u529F"):_.error(u.message)})},t=()=>{if(h.value)return;const l=$({},i.value);h.value=!0,De(l).then(u=>{h.value=!1,u.code===0?_.success("\u4FEE\u6539\u6210\u529F"):_.error(u.message)})},H=()=>{a.emit("close")};return K(()=>e.show,l=>{l&&V()},{immediate:!0}),{Search:x,Refresh:ee,ruleFormRef:r,rules:f,formData:i,roleList:c,departList:p,showPickDepart:m,isEditLoading:h,onClose:H,submitForm:U,handleAvatarSuccess:E,beforeAvatarUpload:I,onConfirmDepart:b,onLoadTreeData:A}}}),Ie={class:"divide-y divide-gray-500/50"},Ae={class:"p-4"},Ve=["src"],Re=w(" \u9009\u62E9\u90E8\u95E8 "),Ue=w(" \u7537 "),Le=w(" \u5973 "),qe=w(" \u6B63\u5E38 "),$e=w(" \u51BB\u7ED3 "),Ne={class:"flex justify-end"},Te=w(" \u53D6\u6D88 "),je=w(" \u786E\u8BA4 ");function Se(e,a,r,m,i,c){const p=te,d=se,F=S("Plus"),f=le,E=ie,I=ue,A=de,C=G,b=he,V=ve,U=ne,h=S("pick-depart"),L=ae;return g(),P(L,{"model-value":e.show,direction:"rtl",size:"604px",onClose:e.onClose},{title:s(()=>[k("h4",Ie,[k("span",null,re(e.user.id?"\u7F16\u8F91":"\u65B0\u589E")+"\u7528\u6237",1)])]),default:s(()=>[k("div",Ae,[o(U,{ref:"ruleFormRef",model:e.formData,rules:e.rules,"label-width":"90px","label-position":"right"},{default:s(()=>[o(d,{label:"\u7528\u6237\u8D26\u53F7",prop:"username"},{default:s(()=>[o(p,{modelValue:e.formData.username,"onUpdate:modelValue":a[0]||(a[0]=t=>e.formData.username=t),disabled:!!e.user.id,placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u8D26\u53F7"},null,8,["modelValue","disabled"])]),_:1}),e.user.id?oe("",!0):(g(),R(N,{key:0},[o(d,{label:"\u767B\u5F55\u5BC6\u7801",prop:"password"},{default:s(()=>[o(p,{modelValue:e.formData.password,"onUpdate:modelValue":a[1]||(a[1]=t=>e.formData.password=t),type:"password",placeholder:"\u8BF7\u8F93\u5165\u767B\u5F55\u5BC6\u7801"},null,8,["modelValue"])]),_:1}),o(d,{label:"\u786E\u8BA4\u5BC6\u7801",prop:"confirmPassword"},{default:s(()=>[o(p,{modelValue:e.formData.confirmPassword,"onUpdate:modelValue":a[2]||(a[2]=t=>e.formData.confirmPassword=t),type:"password",placeholder:"\u8BF7\u8F93\u5165\u786E\u8BA4\u5BC6\u7801"},null,8,["modelValue"])]),_:1})],64)),o(d,{label:"\u7528\u6237\u59D3\u540D",prop:"realname"},{default:s(()=>[o(p,{modelValue:e.formData.realname,"onUpdate:modelValue":a[3]||(a[3]=t=>e.formData.realname=t),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u59D3\u540D"},null,8,["modelValue"])]),_:1}),o(d,{label:"\u5934\u50CF",prop:"avatar"},{default:s(()=>[o(E,{class:"avatar-uploader border border-gray-100",action:"/api/sys/common/upload","show-file-list":!1,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload},{default:s(()=>[e.formData.avatar?(g(),R("img",{key:0,src:e.formData.avatar,class:"avatar"},null,8,Ve)):(g(),P(f,{key:1,class:"avatar-uploader-icon"},{default:s(()=>[o(F)]),_:1}))]),_:1},8,["on-success","before-upload"])]),_:1}),o(d,{label:"\u624B\u673A\u53F7",prop:"phone"},{default:s(()=>[o(p,{modelValue:e.formData.phone,"onUpdate:modelValue":a[4]||(a[4]=t=>e.formData.phone=t),placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7"},null,8,["modelValue"])]),_:1}),o(d,{label:"\u5DE5\u53F7",prop:"workNo"},{default:s(()=>[o(p,{modelValue:e.formData.workNo,"onUpdate:modelValue":a[5]||(a[5]=t=>e.formData.workNo=t),placeholder:"\u8BF7\u8F93\u5165\u5DE5\u53F7"},null,8,["modelValue"])]),_:1}),o(d,{label:"\u89D2\u8272"},{default:s(()=>[o(A,{modelValue:e.formData.roleIdsArr,"onUpdate:modelValue":a[6]||(a[6]=t=>e.formData.roleIdsArr=t),multiple:"",placeholder:"\u8BF7\u9009\u62E9\u89D2\u8272",style:{width:"100%"}},{default:s(()=>[(g(!0),R(N,null,z(e.roleList,t=>(g(),P(I,{key:t.id,label:t.roleName,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(d,{label:"\u6240\u5C5E\u90E8\u95E8"},{default:s(()=>[o(A,{modelValue:e.formData.departIdsArr,"onUpdate:modelValue":a[7]||(a[7]=t=>e.formData.departIdsArr=t),style:{width:"340px","margin-right":"4px"},disabled:"",multiple:"",placeholder:"\u8BF7\u9009\u62E9\u90E8\u95E8"},{default:s(()=>[(g(!0),R(N,null,z(e.departList,t=>(g(),P(I,{key:t.id,label:t.departName,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(C,{type:"primary",onClick:a[8]||(a[8]=t=>e.showPickDepart=!0)},{default:s(()=>[Re]),_:1})]),_:1}),o(d,{label:"\u6027\u522B"},{default:s(()=>[o(V,{modelValue:e.formData.sex,"onUpdate:modelValue":a[9]||(a[9]=t=>e.formData.sex=t)},{default:s(()=>[o(b,{label:"1"},{default:s(()=>[Ue]),_:1}),o(b,{label:"2"},{default:s(()=>[Le]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(d,{label:"\u72B6\u6001"},{default:s(()=>[o(V,{modelValue:e.formData.status,"onUpdate:modelValue":a[10]||(a[10]=t=>e.formData.status=t)},{default:s(()=>[o(b,{label:"1"},{default:s(()=>[qe]),_:1}),o(b,{label:"0"},{default:s(()=>[$e]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),k("div",Ne,[o(C,{onClick:e.onClose},{default:s(()=>[Te]),_:1},8,["onClick"]),o(C,{type:"primary",loading:e.isEditLoading,onClick:a[11]||(a[11]=t=>e.submitForm(e.ruleFormRef))},{default:s(()=>[je]),_:1},8,["loading"])])]),o(h,{show:e.showPickDepart,"checked-keys":e.formData.departIds,onClose:a[12]||(a[12]=t=>e.showPickDepart=!1),onConfirm:e.onConfirmDepart,onLoadTreeData:e.onLoadTreeData},null,8,["show","checked-keys","onConfirm","onLoadTreeData"])]),_:1},8,["model-value","onClose"])}var fa=M(Pe,[["render",Se],["__scopeId","data-v-86afed26"]]);export{fa as A,la as a,ua as b,ma as c,aa as d,ra as e,ta as f,ea as g,da as h,na as i,ia as j,sa as q,oa as r,pa as s};
