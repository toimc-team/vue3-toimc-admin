var me=Object.defineProperty,ge=Object.defineProperties;var ve=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var _e=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable;var J=(l,i,t)=>i in l?me(l,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[i]=t,S=(l,i)=>{for(var t in i||(i={}))_e.call(i,t)&&J(l,t,i[t]);if(Y)for(var t of Y(i))be.call(i,t)&&J(l,t,i[t]);return l},F=(l,i)=>ge(l,ve(i));import{bh as X,b5 as he,s as q,x as m,al as V,aD as y,e as A,av as ye,A as B,g as se,o as v,j as C,w as $,c as R,I as xe,F as g,C as o,b2 as re,W as E,H as _,a as D,b as U,bi as ke,D as P,t as G,a9 as T,S as we,bj as Ee,ar as $e,bk as ze,bl as Re,bm as Ce,J as Ue,bn as Se,L as N,b4 as Fe,am as Le,bo as W,bp as Pe,bq as Te,R as Q,aY as je,b6 as Oe,br as De,B as Z,bs as Be,aH as qe,bt as Ae,V as ee,T as te,aq as Ne}from"./index.58bcf13a.js";import{E as He}from"./el-progress.96f3b0bd.js";const ne=Symbol("uploadContextKey"),Me="ElUpload";class Ke extends Error{constructor(i,t,p,d){super(i),this.name="UploadAjaxError",this.status=t,this.method=p,this.url=d}}function le(l,i,t){let p;return t.response?p=`${t.response.error||t.response}`:t.responseText?p=`${t.responseText}`:p=`fail to ${i.method} ${l} ${t.status}`,new Ke(p,t.status,i.method,l)}function Ie(l){const i=l.responseText||l.response;if(!i)return i;try{return JSON.parse(i)}catch{return i}}const Ve=l=>{typeof XMLHttpRequest=="undefined"&&X(Me,"XMLHttpRequest is undefined");const i=new XMLHttpRequest,t=l.action;i.upload&&i.upload.addEventListener("progress",n=>{const f=n;f.percent=n.total>0?n.loaded/n.total*100:0,l.onProgress(f)});const p=new FormData;if(l.data)for(const[n,f]of Object.entries(l.data))Array.isArray(f)?p.append(n,...f):p.append(n,f);p.append(l.filename,l.file,l.file.name),i.addEventListener("error",()=>{l.onError(le(t,l,i))}),i.addEventListener("load",()=>{if(i.status<200||i.status>=300)return l.onError(le(t,l,i));l.onSuccess(Ie(i))}),i.open(l.method,t,!0),l.withCredentials&&"withCredentials"in i&&(i.withCredentials=!0);const d=l.headers||{};if(d instanceof Headers)d.forEach((n,f)=>i.setRequestHeader(f,n));else for(const[n,f]of Object.entries(d))he(f)||i.setRequestHeader(n,String(f));return i.send(p),i},de=["text","picture","picture-card"];let We=1;const pe=()=>Date.now()+We++,ue=q({action:{type:String,default:"#"},headers:{type:m(Object)},method:{type:String,default:"post"},data:{type:Object,default:()=>V({})},multiple:{type:Boolean,default:!1},name:{type:String,default:"file"},drag:{type:Boolean,default:!1},withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},type:{type:String,default:"select"},fileList:{type:m(Array),default:()=>V([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:de,default:"text"},httpRequest:{type:m(Function),default:Ve},disabled:Boolean,limit:Number}),Xe=q(F(S({},ue),{beforeUpload:{type:m(Function),default:y},beforeRemove:{type:m(Function)},onRemove:{type:m(Function),default:y},onChange:{type:m(Function),default:y},onPreview:{type:m(Function),default:y},onSuccess:{type:m(Function),default:y},onProgress:{type:m(Function),default:y},onError:{type:m(Function),default:y},onExceed:{type:m(Function),default:y}})),Ye=q({files:{type:m(Array),default:()=>V([])},disabled:{type:Boolean,default:!1},handlePreview:{type:m(Function),default:y},listType:{type:String,values:de,default:"text"}}),Je={remove:l=>!!l},Ge=["onKeydown"],Qe=["src"],Ze=["onClick"],et=["onClick"],tt=["onClick"],lt={name:"ElUploadList"},ot=A(F(S({},lt),{props:Ye,emits:Je,setup(l,{emit:i}){const t=l,{t:p}=ye(),d=B("upload"),n=B("icon"),f=B("list"),w=se(!1),z=r=>{t.handlePreview(r)},x=r=>{i("remove",r)};return(r,h)=>(v(),C(Se,{tag:"ul",class:g([o(d).b("list"),o(d).bm("list",r.listType),o(d).is("disabled",r.disabled)]),name:o(f).b()},{default:$(()=>[(v(!0),R(Ue,null,xe(r.files,a=>(v(),R("li",{key:a.uid||a.name,class:g([o(d).be("list","item"),o(d).is(a.status),{focusing:w.value}]),tabindex:"0",onKeydown:re(e=>!r.disabled&&x(a),["delete"]),onFocus:h[0]||(h[0]=e=>w.value=!0),onBlur:h[1]||(h[1]=e=>w.value=!1),onClick:h[2]||(h[2]=e=>w.value=!1)},[E(r.$slots,"default",{file:a},()=>[r.listType==="picture"||a.status!=="uploading"&&r.listType==="picture-card"?(v(),R("img",{key:0,class:g(o(d).be("list","item-thumbnail")),src:a.url,alt:""},null,10,Qe)):_("v-if",!0),r.listType!=="picture"&&(a.status==="uploading"||r.listType!=="picture-card")?(v(),R("div",{key:1,class:g(o(d).be("list","item-info"))},[D("a",{class:g(o(d).be("list","item-name")),onClick:T(e=>z(a),["prevent"])},[U(o(P),{class:g(o(n).m("document"))},{default:$(()=>[U(o(ke))]),_:1},8,["class"]),D("span",{class:g(o(d).be("list","item-file-name"))},G(a.name),3)],10,Ze),a.status==="uploading"?(v(),C(o(He),{key:0,type:r.listType==="picture-card"?"circle":"line","stroke-width":r.listType==="picture-card"?6:2,percentage:Number(a.percentage),style:we(r.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):_("v-if",!0)],2)):_("v-if",!0),D("label",{class:g(o(d).be("list","item-status-label"))},[r.listType==="text"?(v(),C(o(P),{key:0,class:g([o(n).m("upload-success"),o(n).m("circle-check")])},{default:$(()=>[U(o(Ee))]),_:1},8,["class"])):["picture-card","picture"].includes(r.listType)?(v(),C(o(P),{key:1,class:g([o(n).m("upload-success"),o(n).m("check")])},{default:$(()=>[U(o($e))]),_:1},8,["class"])):_("v-if",!0)],2),r.disabled?_("v-if",!0):(v(),C(o(P),{key:2,class:g(o(n).m("close")),onClick:e=>x(a)},{default:$(()=>[U(o(ze))]),_:2},1032,["class","onClick"])),_(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),_(" This is a bug which needs to be fixed "),_(" TODO: Fix the incorrect navigation interaction "),r.disabled?_("v-if",!0):(v(),R("i",{key:3,class:g(o(n).m("close-tip"))},G(o(p)("el.upload.deleteTip")),3)),r.listType==="picture-card"?(v(),R("span",{key:4,class:g(o(d).be("list","item-actions"))},[D("span",{class:g(o(d).be("list","item-preview")),onClick:e=>r.handlePreview(a)},[U(o(P),{class:g(o(n).m("zoom-in"))},{default:$(()=>[U(o(Re))]),_:1},8,["class"])],10,et),r.disabled?_("v-if",!0):(v(),R("span",{key:0,class:g(o(d).be("list","item-delete")),onClick:e=>x(a)},[U(o(P),{class:g(o(n).m("delete"))},{default:$(()=>[U(o(Ce))]),_:1},8,["class"])],10,tt))],2)):_("v-if",!0)])],42,Ge))),128)),E(r.$slots,"append")]),_:3},8,["class","name"]))}}));var oe=N(ot,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-list.vue"]]);const at=q({disabled:{type:Boolean,default:!1}}),it={file:l=>Fe(l)},st=["onDrop","onDragover"],rt={name:"ElUploadDrag"},nt=A(F(S({},rt),{props:at,emits:it,setup(l,{emit:i}){const t=l,p="ElUploadDrag",d=Le(ne);d||X(p,"usage: <el-upload><el-upload-dragger /></el-upload>");const n=B("upload"),f=se(!1),w=x=>{if(t.disabled)return;f.value=!1;const r=Array.from(x.dataTransfer.files),h=d.accept.value;if(!h){i("file",r);return}const a=r.filter(e=>{const{type:s,name:c}=e,b=c.includes(".")?`.${c.split(".").pop()}`:"",u=s.replace(/\/.*$/,"");return h.split(",").map(k=>k.trim()).filter(k=>k).some(k=>k.startsWith(".")?b===k:/\/\*$/.test(k)?u===k.replace(/\/\*$/,""):/^[^/]+\/[^/]+$/.test(k)?s===k:!1)});i("file",a)},z=()=>{t.disabled||(f.value=!0)};return(x,r)=>(v(),R("div",{class:g([o(n).b("dragger"),o(n).is("dragover",f.value)]),onDrop:T(w,["prevent"]),onDragover:T(z,["prevent"]),onDragleave:r[0]||(r[0]=T(h=>f.value=!1,["prevent"]))},[E(x.$slots,"default")],42,st))}}));var dt=N(nt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-dragger.vue"]]);const pt=q(F(S({},ue),{beforeUpload:{type:m(Function),default:y},onRemove:{type:m(Function),default:y},onStart:{type:m(Function),default:y},onSuccess:{type:m(Function),default:y},onProgress:{type:m(Function),default:y},onError:{type:m(Function),default:y},onExceed:{type:m(Function),default:y}})),ut=["onKeydown"],ct=["name","multiple","accept"],ft={name:"ElUploadContent",inheritAttrs:!1},mt=A(F(S({},ft),{props:pt,setup(l,{expose:i}){const t=l,p=B("upload"),d=W({}),n=W(),f=e=>{if(e.length===0)return;const{autoUpload:s,limit:c,fileList:b,multiple:u,onStart:k,onExceed:L}=t;if(c&&b.length+e.length>c){L(e,b);return}u||(e=e.slice(0,1));for(const H of e){const j=H;j.uid=pe(),k(j),s&&w(j)}},w=async e=>{if(n.value.value="",!t.beforeUpload)return z(e);let s;try{s=await t.beforeUpload(e)}catch{s=!1}if(s===!1){t.onRemove(e);return}let c=e;s instanceof Blob&&(s instanceof File?c=s:c=new File([s],e.name,{type:e.type})),z(Object.assign(c,{uid:e.uid}))},z=e=>{const{headers:s,data:c,method:b,withCredentials:u,name:k,action:L,onProgress:H,onSuccess:j,onError:ce,httpRequest:fe}=t,{uid:M}=e,K={headers:s||{},withCredentials:u,file:e,data:c,method:b,filename:k,action:L,onProgress:O=>{H(O,e)},onSuccess:O=>{j(O,e),delete d.value[M]},onError:O=>{ce(O,e),delete d.value[M]}},I=fe(K);d.value[M]=I,I instanceof Promise&&I.then(K.onSuccess,K.onError)},x=e=>{const s=e.target.files;!s||f(Array.from(s))},r=()=>{t.disabled||(n.value.value="",n.value.click())},h=()=>{r()};return i({abort:e=>{Pe(d.value).filter(e?([c])=>String(e.uid)===c:()=>!0).forEach(([c,b])=>{b instanceof XMLHttpRequest&&b.abort(),delete d.value[c]})},upload:w}),(e,s)=>(v(),R("div",{class:g([o(p).b(),o(p).m(e.listType),o(p).is("drag",e.drag)]),tabindex:"0",onClick:r,onKeydown:re(T(h,["self"]),["enter","space"])},[e.drag?(v(),C(dt,{key:0,disabled:e.disabled,onFile:f},{default:$(()=>[E(e.$slots,"default")]),_:3},8,["disabled"])):E(e.$slots,"default",{key:1}),D("input",{ref_key:"inputRef",ref:n,class:g(o(p).e("input")),name:e.name,multiple:e.multiple,accept:e.accept,type:"file",onChange:x,onClick:s[0]||(s[0]=T(()=>{},["stop"]))},null,42,ct)],42,ut))}}));var ae=N(mt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-content.vue"]]);const ie="ElUpload",gt=l=>{var i;(i=l.url)!=null&&i.startsWith("blob:")&&URL.revokeObjectURL(l.url)},vt=(l,i)=>{const t=Te(l,"fileList",void 0,{passive:!0}),p=a=>t.value.find(e=>e.uid===a.uid);function d(a){var e;(e=i.value)==null||e.abort(a)}function n(a=["ready","uploading","success","fail"]){t.value=t.value.filter(e=>!a.includes(e.status))}const f=(a,e)=>{const s=p(e);!s||(console.error(a),s.status="fail",t.value.splice(t.value.indexOf(s),1),l.onError(a,s,t.value),l.onChange(s,t.value))},w=(a,e)=>{const s=p(e);!s||(l.onProgress(a,s,t.value),s.status="uploading",s.percentage=Math.round(a.percent))},z=(a,e)=>{const s=p(e);!s||(s.status="success",s.response=a,l.onSuccess(a,s,t.value),l.onChange(s,t.value))},x=a=>{const e={name:a.name,percentage:0,status:"ready",size:a.size,raw:a,uid:a.uid};if(l.listType==="picture-card"||l.listType==="picture")try{e.url=URL.createObjectURL(a)}catch(s){je(ie,s.message),l.onError(s,e,t.value)}t.value.push(e),l.onChange(e,t.value)},r=async a=>{const e=a instanceof File?p(a):a;e||X(ie,"file to be removed not found");const s=c=>{d(c);const b=t.value;b.splice(b.indexOf(c),1),l.onRemove(c,b),gt(c)};l.beforeRemove?await l.beforeRemove(e,t.value)!==!1&&s(e):s(e)};function h(){t.value.filter(({status:a})=>a==="ready").forEach(({raw:a})=>{var e;return a&&((e=i.value)==null?void 0:e.upload(a))})}return Q(()=>l.listType,a=>{a!=="picture-card"&&a!=="picture"||(t.value=t.value.map(e=>{const{raw:s,url:c}=e;if(!c&&s)try{e.url=URL.createObjectURL(s)}catch(b){l.onError(b,e,t.value)}return e}))}),Q(t,a=>{for(const e of a)e.uid||(e.uid=pe()),e.status||(e.status="success")},{immediate:!0,deep:!0}),{uploadFiles:t,abort:d,clearFiles:n,handleError:f,handleProgress:w,handleStart:x,handleSuccess:z,handleRemove:r,submit:h}},_t={name:"ElUpload"},bt=A(F(S({},_t),{props:Xe,setup(l,{expose:i}){const t=l,p=Oe(),d=De(),n=W(),{abort:f,submit:w,clearFiles:z,uploadFiles:x,handleStart:r,handleError:h,handleRemove:a,handleSuccess:e,handleProgress:s}=vt(t,n),c=Z(()=>t.listType==="picture-card"),b=Z(()=>F(S({},t),{onStart:r,onProgress:s,onSuccess:e,onError:h,onRemove:a}));return Be(()=>{x.value.forEach(({url:u})=>{u!=null&&u.startsWith("blob:")&&URL.revokeObjectURL(u)})}),qe(ne,{accept:Ae(t,"accept")}),i({abort:f,submit:w,clearFiles:z,handleStart:r,handleRemove:a}),(u,k)=>(v(),R("div",null,[o(c)&&u.showFileList?(v(),C(oe,{key:0,disabled:o(d),"list-type":u.listType,files:o(x),"handle-preview":u.onPreview,onRemove:o(a)},ee({append:$(()=>[u.listType==="picture-card"?(v(),C(ae,te({key:0,ref_key:"uploadRef",ref:n},o(b)),{default:$(()=>[o(p).trigger?E(u.$slots,"trigger",{key:0}):_("v-if",!0),!o(p).trigger&&o(p).default?E(u.$slots,"default",{key:1}):_("v-if",!0)]),_:3},16)):_("v-if",!0)]),_:2},[u.$slots.file?{name:"default",fn:$(({file:L})=>[E(u.$slots,"file",{file:L})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):_("v-if",!0),u.listType!=="picture-card"?(v(),C(ae,te({key:1,ref_key:"uploadRef",ref:n},o(b)),{default:$(()=>[o(p).trigger?E(u.$slots,"trigger",{key:0}):_("v-if",!0),!o(p).trigger&&o(p).default?E(u.$slots,"default",{key:1}):_("v-if",!0)]),_:3},16)):_("v-if",!0),u.$slots.trigger?E(u.$slots,"default",{key:2}):_("v-if",!0),E(u.$slots,"tip"),!o(c)&&u.showFileList?(v(),C(oe,{key:3,disabled:o(d),"list-type":u.listType,files:o(x),"handle-preview":u.onPreview,onRemove:o(a)},ee({_:2},[u.$slots.file?{name:"default",fn:$(({file:L})=>[E(u.$slots,"file",{file:L})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):_("v-if",!0)]))}}));var ht=N(bt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload.vue"]]);const wt=Ne(ht);export{wt as E};
