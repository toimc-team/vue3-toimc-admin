var me=Object.defineProperty,ge=Object.defineProperties;var ve=Object.getOwnPropertyDescriptors;var G=Object.getOwnPropertySymbols;var _e=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable;var J=(l,i,t)=>i in l?me(l,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[i]=t,S=(l,i)=>{for(var t in i||(i={}))_e.call(i,t)&&J(l,t,i[t]);if(G)for(var t of G(i))he.call(i,t)&&J(l,t,i[t]);return l},F=(l,i)=>ge(l,ve(i));import{bd as V,be,s as q,x as m,ak as A,aC as y,e as N,au as ye,A as B,g as Y,o as v,j as R,w as $,c as C,I as xe,F as g,C as o,b1 as se,W as E,H as _,a as D,b as U,bf as ke,D as P,t as Q,a9 as T,S as we,bg as Ee,aq as $e,bh as ze,bi as Ce,bj as Re,J as Ue,bk as Se,L as H,bl as Fe,al as Le,bm as X,bn as Pe,R as Z,aX as Te,b9 as je,bo as Oe,B as ee,bp as De,aG as Be,bq as qe,V as te,T as le,ap as Ae}from"./index.b0500663.js";import{E as Ne}from"./el-progress.fd82b5eb.js";const ne=Symbol("uploadContextKey"),He="ElUpload";class Ke extends Error{constructor(i,t,p,d){super(i),this.name="UploadAjaxError",this.status=t,this.method=p,this.url=d}}function oe(l,i,t){let p;return t.response?p=`${t.response.error||t.response}`:t.responseText?p=`${t.responseText}`:p=`fail to ${i.method} ${l} ${t.status}`,new Ke(p,t.status,i.method,l)}function Me(l){const i=l.responseText||l.response;if(!i)return i;try{return JSON.parse(i)}catch{return i}}const Ie=l=>{typeof XMLHttpRequest=="undefined"&&V(He,"XMLHttpRequest is undefined");const i=new XMLHttpRequest,t=l.action;i.upload&&i.upload.addEventListener("progress",n=>{const f=n;f.percent=n.total>0?n.loaded/n.total*100:0,l.onProgress(f)});const p=new FormData;if(l.data)for(const[n,f]of Object.entries(l.data))Array.isArray(f)?p.append(n,...f):p.append(n,f);p.append(l.filename,l.file,l.file.name),i.addEventListener("error",()=>{l.onError(oe(t,l,i))}),i.addEventListener("load",()=>{if(i.status<200||i.status>=300)return l.onError(oe(t,l,i));l.onSuccess(Me(i))}),i.open(l.method,t,!0),l.withCredentials&&"withCredentials"in i&&(i.withCredentials=!0);const d=l.headers||{};if(d instanceof Headers)d.forEach((n,f)=>i.setRequestHeader(f,n));else for(const[n,f]of Object.entries(d))be(f)||i.setRequestHeader(n,String(f));return i.send(p),i},de=["text","picture","picture-card"];let We=1;const pe=()=>Date.now()+We++,ue=q({action:{type:String,default:"#"},headers:{type:m(Object)},method:{type:String,default:"post"},data:{type:Object,default:()=>A({})},multiple:{type:Boolean,default:!1},name:{type:String,default:"file"},drag:{type:Boolean,default:!1},withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},type:{type:String,default:"select"},fileList:{type:m(Array),default:()=>A([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:de,default:"text"},httpRequest:{type:m(Function),default:Ie},disabled:Boolean,limit:Number}),Xe=q(F(S({},ue),{beforeUpload:{type:m(Function),default:y},beforeRemove:{type:m(Function)},onRemove:{type:m(Function),default:y},onChange:{type:m(Function),default:y},onPreview:{type:m(Function),default:y},onSuccess:{type:m(Function),default:y},onProgress:{type:m(Function),default:y},onError:{type:m(Function),default:y},onExceed:{type:m(Function),default:y}})),Ve=q({files:{type:m(Array),default:()=>A([])},disabled:{type:Boolean,default:!1},handlePreview:{type:m(Function),default:y},listType:{type:String,values:de,default:"text"}}),Ye={remove:l=>!!l},Ge=["onKeydown"],Je=["src"],Qe=["onClick"],Ze=["onClick"],et=["onClick"],tt={name:"ElUploadList"},lt=N(F(S({},tt),{props:Ve,emits:Ye,setup(l,{emit:i}){const t=l,{t:p}=ye(),d=B("upload"),n=B("icon"),f=B("list"),w=Y(!1),z=s=>{t.handlePreview(s)},x=s=>{i("remove",s)};return(s,b)=>(v(),R(Se,{tag:"ul",class:g([o(d).b("list"),o(d).bm("list",s.listType),o(d).is("disabled",s.disabled)]),name:o(f).b()},{default:$(()=>[(v(!0),C(Ue,null,xe(s.files,a=>(v(),C("li",{key:a.uid||a.name,class:g([o(d).be("list","item"),o(d).is(a.status),{focusing:w.value}]),tabindex:"0",onKeydown:se(e=>!s.disabled&&x(a),["delete"]),onFocus:b[0]||(b[0]=e=>w.value=!0),onBlur:b[1]||(b[1]=e=>w.value=!1),onClick:b[2]||(b[2]=e=>w.value=!1)},[E(s.$slots,"default",{file:a},()=>[s.listType==="picture"||a.status!=="uploading"&&s.listType==="picture-card"?(v(),C("img",{key:0,class:g(o(d).be("list","item-thumbnail")),src:a.url,alt:""},null,10,Je)):_("v-if",!0),s.listType!=="picture"&&(a.status==="uploading"||s.listType!=="picture-card")?(v(),C("div",{key:1,class:g(o(d).be("list","item-info"))},[D("a",{class:g(o(d).be("list","item-name")),onClick:T(e=>z(a),["prevent"])},[U(o(P),{class:g(o(n).m("document"))},{default:$(()=>[U(o(ke))]),_:1},8,["class"]),D("span",{class:g(o(d).be("list","item-file-name"))},Q(a.name),3)],10,Qe),a.status==="uploading"?(v(),R(o(Ne),{key:0,type:s.listType==="picture-card"?"circle":"line","stroke-width":s.listType==="picture-card"?6:2,percentage:Number(a.percentage),style:we(s.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):_("v-if",!0)],2)):_("v-if",!0),D("label",{class:g(o(d).be("list","item-status-label"))},[s.listType==="text"?(v(),R(o(P),{key:0,class:g([o(n).m("upload-success"),o(n).m("circle-check")])},{default:$(()=>[U(o(Ee))]),_:1},8,["class"])):["picture-card","picture"].includes(s.listType)?(v(),R(o(P),{key:1,class:g([o(n).m("upload-success"),o(n).m("check")])},{default:$(()=>[U(o($e))]),_:1},8,["class"])):_("v-if",!0)],2),s.disabled?_("v-if",!0):(v(),R(o(P),{key:2,class:g(o(n).m("close")),onClick:e=>x(a)},{default:$(()=>[U(o(ze))]),_:2},1032,["class","onClick"])),_(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),_(" This is a bug which needs to be fixed "),_(" TODO: Fix the incorrect navigation interaction "),s.disabled?_("v-if",!0):(v(),C("i",{key:3,class:g(o(n).m("close-tip"))},Q(o(p)("el.upload.deleteTip")),3)),s.listType==="picture-card"?(v(),C("span",{key:4,class:g(o(d).be("list","item-actions"))},[D("span",{class:g(o(d).be("list","item-preview")),onClick:e=>s.handlePreview(a)},[U(o(P),{class:g(o(n).m("zoom-in"))},{default:$(()=>[U(o(Ce))]),_:1},8,["class"])],10,Ze),s.disabled?_("v-if",!0):(v(),C("span",{key:0,class:g(o(d).be("list","item-delete")),onClick:e=>x(a)},[U(o(P),{class:g(o(n).m("delete"))},{default:$(()=>[U(o(Re))]),_:1},8,["class"])],10,et))],2)):_("v-if",!0)])],42,Ge))),128)),E(s.$slots,"append")]),_:3},8,["class","name"]))}}));var ae=H(lt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-list.vue"]]);const ot=q({disabled:{type:Boolean,default:!1}}),at={file:l=>Fe(l)},it=["onDrop","onDragover"],rt={name:"ElUploadDrag"},st=N(F(S({},rt),{props:ot,emits:at,setup(l,{emit:i}){const t=l,p="ElUploadDrag",d=Le(ne);d||V(p,"usage: <el-upload><el-upload-dragger /></el-upload>");const n=B("upload"),f=Y(!1),w=x=>{if(t.disabled)return;f.value=!1;const s=Array.from(x.dataTransfer.files),b=d.accept.value;if(!b){i("file",s);return}const a=s.filter(e=>{const{type:r,name:c}=e,h=c.includes(".")?`.${c.split(".").pop()}`:"",u=r.replace(/\/.*$/,"");return b.split(",").map(k=>k.trim()).filter(k=>k).some(k=>k.startsWith(".")?h===k:/\/\*$/.test(k)?u===k.replace(/\/\*$/,""):/^[^/]+\/[^/]+$/.test(k)?r===k:!1)});i("file",a)},z=()=>{t.disabled||(f.value=!0)};return(x,s)=>(v(),C("div",{class:g([o(n).b("dragger"),o(n).is("dragover",f.value)]),onDrop:T(w,["prevent"]),onDragover:T(z,["prevent"]),onDragleave:s[0]||(s[0]=T(b=>f.value=!1,["prevent"]))},[E(x.$slots,"default")],42,it))}}));var nt=H(st,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-dragger.vue"]]);const dt=q(F(S({},ue),{fileList:{type:m(Array),default:()=>A([])},beforeUpload:{type:m(Function),default:y},onRemove:{type:m(Function),default:y},onStart:{type:m(Function),default:y},onSuccess:{type:m(Function),default:y},onProgress:{type:m(Function),default:y},onError:{type:m(Function),default:y},onExceed:{type:m(Function),default:y}})),pt=["onKeydown"],ut=["name","multiple","accept"],ct={name:"ElUploadContent",inheritAttrs:!1},ft=N(F(S({},ct),{props:dt,setup(l,{expose:i}){const t=l,p=B("upload"),d=X({}),n=X(),f=e=>{if(e.length===0)return;const{autoUpload:r,limit:c,fileList:h,multiple:u,onStart:k,onExceed:L}=t;if(c&&h.length+e.length>c){L(e,h);return}u||(e=e.slice(0,1));for(const K of e){const j=K;j.uid=pe(),k(j),r&&w(j)}},w=async e=>{if(n.value.value="",!t.beforeUpload)return z(e);let r;try{r=await t.beforeUpload(e)}catch{r=!1}if(r===!1){t.onRemove(e);return}let c=e;r instanceof Blob&&(r instanceof File?c=r:c=new File([r],e.name,{type:e.type})),z(Object.assign(c,{uid:e.uid}))},z=e=>{const{headers:r,data:c,method:h,withCredentials:u,name:k,action:L,onProgress:K,onSuccess:j,onError:ce,httpRequest:fe}=t,{uid:M}=e,I={headers:r||{},withCredentials:u,file:e,data:c,method:h,filename:k,action:L,onProgress:O=>{K(O,e)},onSuccess:O=>{j(O,e),delete d.value[M]},onError:O=>{ce(O,e),delete d.value[M]}},W=fe(I);d.value[M]=W,W instanceof Promise&&W.then(I.onSuccess,I.onError)},x=e=>{const r=e.target.files;!r||f(Array.from(r))},s=()=>{t.disabled||(n.value.value="",n.value.click())},b=()=>{s()};return i({abort:e=>{Pe(d.value).filter(e?([c])=>String(e.uid)===c:()=>!0).forEach(([c,h])=>{h instanceof XMLHttpRequest&&h.abort(),delete d.value[c]})},upload:w}),(e,r)=>(v(),C("div",{class:g([o(p).b(),o(p).m(e.listType),o(p).is("drag",e.drag)]),tabindex:"0",onClick:s,onKeydown:se(T(b,["self"]),["enter","space"])},[e.drag?(v(),R(nt,{key:0,disabled:e.disabled,onFile:f},{default:$(()=>[E(e.$slots,"default")]),_:3},8,["disabled"])):E(e.$slots,"default",{key:1}),D("input",{ref_key:"inputRef",ref:n,class:g(o(p).e("input")),name:e.name,multiple:e.multiple,accept:e.accept,type:"file",onChange:x,onClick:r[0]||(r[0]=T(()=>{},["stop"]))},null,42,ut)],42,pt))}}));var ie=H(ft,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-content.vue"]]);const re="ElUpload",mt=l=>{var i;(i=l.url)!=null&&i.startsWith("blob:")&&URL.revokeObjectURL(l.url)},gt=(l,i)=>{const t=Y([]),p=a=>t.value.find(e=>e.uid===a.uid);function d(a){var e;(e=i.value)==null||e.abort(a)}function n(a=["ready","uploading","success","fail"]){t.value=t.value.filter(e=>!a.includes(e.status))}const f=(a,e)=>{const r=p(e);!r||(r.status="fail",t.value.splice(t.value.indexOf(r),1),l.onError(a,r,t.value),l.onChange(r,t.value))},w=(a,e)=>{const r=p(e);!r||(l.onProgress(a,r,t.value),r.status="uploading",r.percentage=Math.round(a.percent))},z=(a,e)=>{const r=p(e);!r||(r.status="success",r.response=a,l.onSuccess(a,r,t.value),l.onChange(r,t.value))},x=a=>{const e={name:a.name,percentage:0,status:"ready",size:a.size,raw:a,uid:a.uid};if(l.listType==="picture-card"||l.listType==="picture")try{e.url=URL.createObjectURL(a)}catch(r){Te(re,r.message),l.onError(r,e,t.value)}t.value.push(e),l.onChange(e,t.value)},s=async a=>{const e=a instanceof File?p(a):a;e||V(re,"file to be removed not found");const r=c=>{d(c);const h=t.value;h.splice(h.indexOf(c),1),l.onRemove(c,h),mt(c)};l.beforeRemove?await l.beforeRemove(e,t.value)!==!1&&r(e):r(e)};function b(){t.value.filter(({status:a})=>a==="ready").forEach(({raw:a})=>{var e;return a&&((e=i.value)==null?void 0:e.upload(a))})}return Z(()=>l.listType,a=>{a!=="picture-card"&&a!=="picture"||(t.value=t.value.map(e=>{const{raw:r,url:c}=e;if(!c&&r)try{e.url=URL.createObjectURL(r)}catch(h){l.onError(h,e,t.value)}return e}))}),Z(()=>l.fileList,a=>{for(const e of a)e.uid||(e.uid=pe()),e.status||(e.status="success");t.value=a},{immediate:!0,deep:!0}),{abort:d,clearFiles:n,handleError:f,handleProgress:w,handleStart:x,handleSuccess:z,handleRemove:s,submit:b,uploadFiles:t}},vt={name:"ElUpload"},_t=N(F(S({},vt),{props:Xe,setup(l,{expose:i}){const t=l,p=je(),d=Oe(),n=X(),{abort:f,submit:w,clearFiles:z,uploadFiles:x,handleStart:s,handleError:b,handleRemove:a,handleSuccess:e,handleProgress:r}=gt(t,n),c=ee(()=>t.listType==="picture-card"),h=ee(()=>F(S({},t),{onStart:s,onProgress:r,onSuccess:e,onError:b,onRemove:a}));return De(()=>{x.value.forEach(({url:u})=>{u!=null&&u.startsWith("blob:")&&URL.revokeObjectURL(u)})}),Be(ne,{accept:qe(t,"accept")}),i({abort:f,submit:w,clearFiles:z,handleStart:s,handleRemove:a}),(u,k)=>(v(),C("div",null,[o(c)&&u.showFileList?(v(),R(ae,{key:0,disabled:o(d),"list-type":u.listType,files:o(x),"handle-preview":u.onPreview,onRemove:o(a)},te({append:$(()=>[u.listType==="picture-card"?(v(),R(ie,le({key:0,ref_key:"uploadRef",ref:n},o(h)),{default:$(()=>[o(p).trigger?E(u.$slots,"trigger",{key:0}):_("v-if",!0),!o(p).trigger&&o(p).default?E(u.$slots,"default",{key:1}):_("v-if",!0)]),_:3},16)):_("v-if",!0)]),_:2},[u.$slots.file?{name:"default",fn:$(({file:L})=>[E(u.$slots,"file",{file:L})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):_("v-if",!0),u.listType!=="picture-card"?(v(),R(ie,le({key:1,ref_key:"uploadRef",ref:n},o(h)),{default:$(()=>[o(p).trigger?E(u.$slots,"trigger",{key:0}):_("v-if",!0),!o(p).trigger&&o(p).default?E(u.$slots,"default",{key:1}):_("v-if",!0)]),_:3},16)):_("v-if",!0),u.$slots.trigger?E(u.$slots,"default",{key:2}):_("v-if",!0),E(u.$slots,"tip"),!o(c)&&u.showFileList?(v(),R(ae,{key:3,disabled:o(d),"list-type":u.listType,files:o(x),"handle-preview":u.onPreview,onRemove:o(a)},te({_:2},[u.$slots.file?{name:"default",fn:$(({file:L})=>[E(u.$slots,"file",{file:L})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):_("v-if",!0)]))}}));var ht=H(_t,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload.vue"]]);const kt=Ae(ht);export{kt as E};
